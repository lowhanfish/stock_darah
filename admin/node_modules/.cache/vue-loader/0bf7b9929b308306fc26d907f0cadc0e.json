{"remainingRequest":"/Users/simplephi/Documents/riswan/stock_darah/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/simplephi/Documents/riswan/stock_darah/admin/src/views/dataMaster/regisPendonor.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/simplephi/Documents/riswan/stock_darah/admin/src/views/dataMaster/regisPendonor.vue","mtime":1761490339749},{"path":"/Users/simplephi/Documents/riswan/stock_darah/admin/node_modules/cache-loader/dist/cjs.js","mtime":1758930418112},{"path":"/Users/simplephi/Documents/riswan/stock_darah/admin/node_modules/babel-loader/lib/index.js","mtime":1758930419036},{"path":"/Users/simplephi/Documents/riswan/stock_darah/admin/node_modules/vue-cli-plugin-quasar/lib/loader.auto-import.js","mtime":1758930412679},{"path":"/Users/simplephi/Documents/riswan/stock_darah/admin/node_modules/cache-loader/dist/cjs.js","mtime":1758930418112},{"path":"/Users/simplephi/Documents/riswan/stock_darah/admin/node_modules/vue-loader/lib/index.js","mtime":1758930412640}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBVTVVNIGZyb20gIi4uLy4uL2xpYnJhcnkvdW11bS5qcyI7CmV4cG9ydCBkZWZhdWx0IHsKICAgZGF0YSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICAgVU1VTTogVU1VTSwKICAgICAgICAgaXNQd2Q6IHRydWUsCiAgICAgICAgIGlzUHdkMjogdHJ1ZSwKICAgICAgICAgYnRuX3Bhc3N3b3JkOiBmYWxzZSwKCiAgICAgICAgIGZvcm06IHsKICAgICAgICAgICAgaWQ6IG51bGwsCiAgICAgICAgICAgIHVzZXJzX2lkOiBudWxsLAogICAgICAgICAgICBuYW1hX2xlbmdrYXA6ICcnLAogICAgICAgICAgICBuaWs6ICcnLAogICAgICAgICAgICB0YW5nZ2FsX2xhaGlyOiAnJywKICAgICAgICAgICAgamVuaXNfa2VsYW1pbjogJycsCiAgICAgICAgICAgIGdvbG9uZ2FuX2RhcmFoOiAnJywKICAgICAgICAgICAgcmhlc3VzOiAnJywKICAgICAgICAgICAga2FidXBhdGVuX2lkOiBudWxsLAogICAgICAgICAgICBrZWNhbWF0YW5faWQ6IG51bGwsCiAgICAgICAgICAgIGRlc19rZWxfaWQ6IG51bGwsCiAgICAgICAgICAgIGFsYW1hdDogJycsCiAgICAgICAgICAgIGVtYWlsOiAnJywKICAgICAgICAgICAgbm9faHA6ICcnLAogICAgICAgICAgICByaXdheWF0X3Blbnlha2l0OiBudWxsLAogICAgICAgICAgICB0ZXJha2hpcl9kb25vcjogbnVsbCwKICAgICAgICAgICAgZm90b19wcm9maWw6IG51bGwsCiAgICAgICAgICAgIGRva3VtZW5fcGVuZHVrdW5nOiBudWxsLAogICAgICAgICAgICBmb3RvX3Byb2ZpbF91cmw6ICcnLAogICAgICAgICAgICBkb2t1bWVuX3BlbmR1a3VuZ191cmw6ICcnLAogICAgICAgICAgICBzdG9rZGFyYWhfa29udXQ6IDQsCiAgICAgICAgICAgIGJlcnNlZGlhX2RpcHVibGlrYXNpa2FuOiB0cnVlLAogICAgICAgICB9LAogICAgICAgICBrYWJ1cGF0ZW5PcHRpb25zOiBbXSwKICAgICAgICAga2VjYW1hdGFuT3B0aW9uczogW10sCiAgICAgICAgIGRlc2tlbE9wdGlvbnM6IFtdLAoKICAgICAgICAgbWRsX2FkZDogZmFsc2UsCiAgICAgICAgIG1kbF9lZGl0OiBmYWxzZSwKICAgICAgICAgbWRsX2hhcHVzOiBmYWxzZSwKICAgICAgICAgYnRuX2FkZDogZmFsc2UsCiAgICAgICAgIGJ0bl9lZGl0OiBmYWxzZSwKICAgICAgICAgYnRuX2hhcHVzOiBmYWxzZSwKCiAgICAgICAgIGxpc3RfZGF0YTogW10sCiAgICAgICAgIGptbF9kYXRhOiAwLAogICAgICAgICB0b3RhbF9kYXRhOiAwLAogICAgICAgICBwYWdlX2ZpcnN0OiAxLAogICAgICAgICBwYWdlX2xhc3Q6IDAsCiAgICAgICAgIHBhZ2VfbGltaXQ6IDEwLAogICAgICAgICBjYXJpX3ZhbHVlOiAnJywKCiAgICAgICAgIG1kbF9yaXdheWF0OiBmYWxzZSwKY3VycmVudFBlbmRvbm9yOiB7fSwKcml3YXlhdExpc3Q6IFtdLApyaXdheWF0TG9hZGluZzogZmFsc2UsCgoKCiAgICAgICAgIG1kbF9wYXNzd29yZDogZmFsc2UsCiAgICAgICAgIGRhdGFrdTogewogICAgICAgICAgICB1c2VybmFtZTogJycsCiAgICAgICAgICAgIHBhc3N3b3JkOiAnJywKICAgICAgICAgICAgY29uZmlybVBhc3N3b3JkOiAnJwogICAgICAgICB9LAogICAgICAgICBlcnJvck1lc3NhZ2U6ICcnLAogICAgICAgICBtZGxfbGloYXQ6IGZhbHNlLAogICAgICAgICBsaWhhdERhdGE6IHsKICAgICAgICAgICAgbmFtYV9sZW5na2FwOiAnJywKICAgICAgICAgICAgdGFuZ2dhbF9sYWhpcjogJycsCiAgICAgICAgICAgIGplbmlzX2tlbGFtaW46ICcnLAogICAgICAgICAgICBnb2xvbmdhbl9kYXJhaDogJycsCiAgICAgICAgICAgIHJoZXN1czogJycsCiAgICAgICAgICAgIGVtYWlsOiAnJywKICAgICAgICAgICAgbm9faHA6ICcnLAogICAgICAgICAgICBhbGFtYXQ6ICcnLAogICAgICAgICAgICByaXdheWF0X3Blbnlha2l0OiAnJywKICAgICAgICAgICAgdGVyYWtoaXJfZG9ub3I6ICcnLAogICAgICAgICAgICBrYWJ1cGF0ZW5fbmFtYTogJycsCiAgICAgICAgICAgIGtlY2FtYXRhbl9uYW1hOiAnJywKICAgICAgICAgICAgZGVzX2tlbF9uYW1hOiAnJywKICAgICAgICAgICAgZm90b19wcm9maWw6ICcnLAogICAgICAgICAgICBkb2t1bWVuX3BlbmR1a3VuZzogJycsCiAgICAgICAgICAgIHVzZXJuYW1lOiAnJywKICAgICAgICAgICAgdXNlcnNfaWQ6ICcnLAogICAgICAgICAgICBpZDogJycsCiAgICAgICAgIH0sCiAgICAgIH0KICAgfSwKICAgY29tcHV0ZWQ6IHsKICAgICAgZmlsZV9wYXRoKCkgewogICAgICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUudXJsLlVSTF9BUFAgKyAidXBsb2Fkcy8iOwogICAgICB9CiAgIH0sCiAgIHdhdGNoOiB7CiAgICAgICdmb3JtLmthYnVwYXRlbl9pZCcobmV3VmFsKSB7CiAgICAgICAgIHRoaXMuZm9ybS5rZWNhbWF0YW5faWQgPSBudWxsOwogICAgICAgICB0aGlzLmZvcm0uZGVzX2tlbF9pZCA9IG51bGw7CiAgICAgICAgIHRoaXMua2VjYW1hdGFuT3B0aW9ucyA9IFtdOwogICAgICAgICB0aGlzLmRlc2tlbE9wdGlvbnMgPSBbXTsKICAgICAgICAgaWYgKG5ld1ZhbCkgewogICAgICAgICAgICB0aGlzLmxvYWRLZWNhbWF0YW4obmV3VmFsKTsKICAgICAgICAgfQogICAgICB9LAogICAgICAnZm9ybS5rZWNhbWF0YW5faWQnKG5ld1ZhbCkgewogICAgICAgICB0aGlzLmZvcm0uZGVzX2tlbF9pZCA9IG51bGw7CiAgICAgICAgIHRoaXMuZGVza2VsT3B0aW9ucyA9IFtdOwogICAgICAgICBpZiAobmV3VmFsKSB7CiAgICAgICAgICAgIHRoaXMubG9hZERlc2tlbChuZXdWYWwpOwogICAgICAgICB9CiAgICAgIH0KICAgfSwKICAgbWV0aG9kczogewogICAgICBsb2FkS2FidXBhdGVuKCkgewogICAgICAgICBmZXRjaCh0aGlzLiRzdG9yZS5zdGF0ZS51cmwuUkVHSVNfRE9OT1IgKyAia2FidXBhdGVuIikKICAgICAgICAgICAgLnRoZW4ocmVzID0+IHJlcy5qc29uKCkpCiAgICAgICAgICAgIC50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgIGlmIChyZXMuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICB0aGlzLmthYnVwYXRlbk9wdGlvbnMgPSByZXMuZGF0YS5tYXAoaXRlbSA9PiAoewogICAgICAgICAgICAgICAgICAgICBsYWJlbDogaXRlbS5sYWJlbCwKICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGl0ZW0uaWQKICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aGlzLiRxLm5vdGlmeSh7IHR5cGU6ICduZWdhdGl2ZScsIG1lc3NhZ2U6ICdHYWdhbCBtZW11YXQgZGF0YSBrYWJ1cGF0ZW4nIH0pOwogICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgIHRoaXMuJHEubm90aWZ5KHsgdHlwZTogJ25lZ2F0aXZlJywgbWVzc2FnZTogJ1RlcmphZGkga2VzYWxhaGFuIHNhYXQgbWVtdWF0IGthYnVwYXRlbicgfSk7CiAgICAgICAgICAgIH0pOwogICAgICB9LAogICAgICBsb2FkS2VjYW1hdGFuKGthYnVwYXRlbklkKSB7CiAgICAgICAgIGZldGNoKGAke3RoaXMuJHN0b3JlLnN0YXRlLnVybC5SRUdJU19ET05PUn1rZWNhbWF0YW4/a2FidXBhdGVuX2lkPSR7a2FidXBhdGVuSWR9YCkKICAgICAgICAgICAgLnRoZW4ocmVzID0+IHJlcy5qc29uKCkpCiAgICAgICAgICAgIC50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgIGlmIChyZXMuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICB0aGlzLmtlY2FtYXRhbk9wdGlvbnMgPSByZXMuZGF0YS5tYXAoaXRlbSA9PiAoewogICAgICAgICAgICAgICAgICAgICBsYWJlbDogaXRlbS5sYWJlbCwKICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGl0ZW0uaWQKICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aGlzLiRxLm5vdGlmeSh7IHR5cGU6ICduZWdhdGl2ZScsIG1lc3NhZ2U6ICdHYWdhbCBtZW11YXQgZGF0YSBrZWNhbWF0YW4nIH0pOwogICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgIHRoaXMuJHEubm90aWZ5KHsgdHlwZTogJ25lZ2F0aXZlJywgbWVzc2FnZTogJ1RlcmphZGkga2VzYWxhaGFuIHNhYXQgbWVtdWF0IGtlY2FtYXRhbicgfSk7CiAgICAgICAgICAgIH0pOwogICAgICB9LAogICAgICBsb2FkRGVza2VsKGtlY2FtYXRhbklkKSB7CiAgICAgICAgIGZldGNoKGAke3RoaXMuJHN0b3JlLnN0YXRlLnVybC5SRUdJU19ET05PUn1kZXNrZWw/a2VjYW1hdGFuX2lkPSR7a2VjYW1hdGFuSWR9YCkKICAgICAgICAgICAgLnRoZW4ocmVzID0+IHJlcy5qc29uKCkpCiAgICAgICAgICAgIC50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgIGlmIChyZXMuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICB0aGlzLmRlc2tlbE9wdGlvbnMgPSByZXMuZGF0YS5tYXAoaXRlbSA9PiAoewogICAgICAgICAgICAgICAgICAgICBsYWJlbDogaXRlbS5sYWJlbCwKICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGl0ZW0uaWQKICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aGlzLiRxLm5vdGlmeSh7IHR5cGU6ICduZWdhdGl2ZScsIG1lc3NhZ2U6ICdHYWdhbCBtZW11YXQgZGF0YSBkZXNhL2tlbHVyYWhhbicgfSk7CiAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgICAgdGhpcy4kcS5ub3RpZnkoeyB0eXBlOiAnbmVnYXRpdmUnLCBtZXNzYWdlOiAnVGVyamFkaSBrZXNhbGFoYW4gc2FhdCBtZW11YXQgZGVzYS9rZWx1cmFoYW4nIH0pOwogICAgICAgICAgICB9KTsKICAgICAgfSwKCgogICAgICBnZXRWaWV3KCkgewogICAgICAgICBjb25zdCBib2R5ID0gewogICAgICAgICAgICBwYWdlX2xpbWl0OiB0aGlzLnBhZ2VfbGltaXQsCiAgICAgICAgICAgIGRhdGFfa2U6ICh0aGlzLnBhZ2VfZmlyc3QgLSAxKSAqIHRoaXMucGFnZV9saW1pdCwKICAgICAgICAgICAgY2FyaV92YWx1ZTogdGhpcy5jYXJpX3ZhbHVlLAogICAgICAgICB9OwoKICAgICAgICAgZmV0Y2godGhpcy4kc3RvcmUuc3RhdGUudXJsLlJFR0lTX0RPTk9SICsgImdldHZpZXciLCB7CiAgICAgICAgICAgIG1ldGhvZDogIlBPU1QiLAogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICJjb250ZW50LXR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgICAgICAgIGF1dGhvcml6YXRpb246ICJraWtlbnNiYXRhcmEgIiArIGxvY2FsU3RvcmFnZS50b2tlbgogICAgICAgICAgICB9LAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShib2R5KQogICAgICAgICB9KQogICAgICAgICAgICAudGhlbihyZXMgPT4gcmVzLmpzb24oKSkKICAgICAgICAgICAgLnRoZW4ocmVzX2RhdGEgPT4gewogICAgICAgICAgICAgICBpZiAocmVzX2RhdGEuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICB0aGlzLmxpc3RfZGF0YSA9IHJlc19kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgIHRoaXMuam1sX2RhdGEgPSByZXNfZGF0YS5qbWxfZGF0YTsKICAgICAgICAgICAgICAgICAgdGhpcy50b3RhbF9kYXRhID0gcmVzX2RhdGEudG90YWxfZGF0YTsKICAgICAgICAgICAgICAgICAgdGhpcy5wYWdlX2xhc3QgPSBNYXRoLmNlaWwodGhpcy50b3RhbF9kYXRhIC8gdGhpcy5wYWdlX2xpbWl0KTsKICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdGhpcy4kcS5ub3RpZnkoeyB0eXBlOiAibmVnYXRpdmUiLCBtZXNzYWdlOiByZXNfZGF0YS5tZXNzYWdlIHx8ICJHYWdhbCBtZW5nYW1iaWwgZGF0YSIgfSk7CiAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7CiAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGZldGNoaW5nIGRhdGE6IiwgZXJyKTsKICAgICAgICAgICAgICAgdGhpcy4kcS5ub3RpZnkoeyB0eXBlOiAibmVnYXRpdmUiLCBtZXNzYWdlOiAiR2FnYWwgbWVuZ2FtYmlsIGRhdGEgcGVuZG9ub3IiIH0pOwogICAgICAgICAgICB9KTsKICAgICAgfSwKCiAgICAgIGFzeW5jIGFkZERhdGEoKSB7CiAgICAgICAgIHRyeSB7CgogICAgICAgICAgICBpZiAodGhpcy5kYXRha3UucGFzc3dvcmQgIT09IHRoaXMuZGF0YWt1LmNvbmZpcm1QYXNzd29yZCkgewogICAgICAgICAgICAgICB0aGlzLiRxLm5vdGlmeSh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICduZWdhdGl2ZScsCiAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdQYXNzd29yZCBkYW4ga29uZmlybWFzaSBwYXNzd29yZCB0aWRhayBzYW1hIScKICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5kYXRha3UucGFzc3dvcmQubGVuZ3RoIDwgNikgewogICAgICAgICAgICAgICB0aGlzLiRxLm5vdGlmeSh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICduZWdhdGl2ZScsCiAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdQYXNzd29yZCBtaW5pbWFsIDYga2FyYWt0ZXIhJwogICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghdGhpcy5kYXRha3UudXNlcm5hbWUpIHsKICAgICAgICAgICAgICAgdGhpcy4kcS5ub3RpZnkoewogICAgICAgICAgICAgICAgICB0eXBlOiAnbmVnYXRpdmUnLAogICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnVXNlcm5hbWUgd2FqaWIgZGlpc2khJwogICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmJ0bl9hZGQgPSB0cnVlOwoKICAgICAgICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCduYW1hX2xlbmdrYXAnLCB0aGlzLmZvcm0ubmFtYV9sZW5na2FwKTsKICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCduaWsnLCB0aGlzLmZvcm0ubmlrKTsKICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCd0YW5nZ2FsX2xhaGlyJywgdGhpcy5mb3JtLnRhbmdnYWxfbGFoaXIpOwogICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2plbmlzX2tlbGFtaW4nLCB0aGlzLmZvcm0uamVuaXNfa2VsYW1pbik7CiAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnZ29sb25nYW5fZGFyYWgnLCB0aGlzLmZvcm0uZ29sb25nYW5fZGFyYWgpOwogICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ3JoZXN1cycsIHRoaXMuZm9ybS5yaGVzdXMgfHwgJycpOwogICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2thYnVwYXRlbl9pZCcsIHRoaXMuZm9ybS5rYWJ1cGF0ZW5faWQgfHwgJycpOwogICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2tlY2FtYXRhbl9pZCcsIHRoaXMuZm9ybS5rZWNhbWF0YW5faWQgfHwgJycpOwogICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2Rlc19rZWxfaWQnLCB0aGlzLmZvcm0uZGVzX2tlbF9pZCB8fCAnJyk7CiAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnYWxhbWF0JywgdGhpcy5mb3JtLmFsYW1hdCB8fCAnJyk7CiAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnZW1haWwnLCB0aGlzLmZvcm0uZW1haWwgfHwgJycpOwogICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ25vX2hwJywgdGhpcy5mb3JtLm5vX2hwIHx8ICcnKTsKICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdyaXdheWF0X3Blbnlha2l0JywgdGhpcy5mb3JtLnJpd2F5YXRfcGVueWFraXQgfHwgJycpOwogICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ3RlcmFraGlyX2Rvbm9yJywgdGhpcy5mb3JtLnRlcmFraGlyX2Rvbm9yIHx8ICcnKTsKICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdzdG9rZGFyYWhfa29udXQnLCB0aGlzLmZvcm0uc3Rva2RhcmFoX2tvbnV0IHx8IDQpOwogICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2JlcnNlZGlhX2RpcHVibGlrYXNpa2FuJywgMSk7CgoKICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCd1c2VybmFtZScsIHRoaXMuZGF0YWt1LnVzZXJuYW1lKTsKICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdwYXNzd29yZCcsIHRoaXMuZGF0YWt1LnBhc3N3b3JkKTsKCiAgICAgICAgICAgIC8vIEFwcGVuZCBmaWxlCiAgICAgICAgICAgIGlmICh0aGlzLmZvcm0uZm90b19wcm9maWwgJiYgdGhpcy5mb3JtLmZvdG9fcHJvZmlsIGluc3RhbmNlb2YgRmlsZSkgewogICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2ZvdG9fcHJvZmlsJywgdGhpcy5mb3JtLmZvdG9fcHJvZmlsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5mb3JtLmRva3VtZW5fcGVuZHVrdW5nICYmIHRoaXMuZm9ybS5kb2t1bWVuX3BlbmR1a3VuZyBpbnN0YW5jZW9mIEZpbGUpIHsKICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdkb2t1bWVuX3BlbmR1a3VuZycsIHRoaXMuZm9ybS5kb2t1bWVuX3BlbmR1a3VuZyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godGhpcy4kc3RvcmUuc3RhdGUudXJsLlJFR0lTX0RPTk9SICsgImFkZERhdGEiLCB7CiAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgIGF1dGhvcml6YXRpb246ICJraWtlbnNiYXRhcmEgIiArIGxvY2FsU3RvcmFnZS50b2tlbgogICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICBib2R5OiBmb3JtRGF0YQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsKCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5vayAmJiByZXN1bHQuc3VjY2VzcykgewogICAgICAgICAgICAgICB0aGlzLiRxLm5vdGlmeSh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICdwb3NpdGl2ZScsCiAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHJlc3VsdC5tZXNzYWdlIHx8ICdEYXRhIHBlbmRvbm9yIGJlcmhhc2lsIGRpdGFtYmFoa2FuIScKICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICB0aGlzLnJlc2V0Rm9ybSgpOwogICAgICAgICAgICAgICB0aGlzLm1kbF9hZGQgPSBmYWxzZTsKICAgICAgICAgICAgICAgdGhpcy5nZXRWaWV3KCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihyZXN1bHQubWVzc2FnZSB8fCAnVGVyamFkaSBrZXNhbGFoYW4gc2FhdCBtZW5hbWJhaCBkYXRhJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWRkaW5nIGRhdGE6JywgZXJyb3IpOwogICAgICAgICAgICB0aGlzLiRxLm5vdGlmeSh7CiAgICAgICAgICAgICAgIHR5cGU6ICduZWdhdGl2ZScsCiAgICAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0dhZ2FsIG1lbmFtYmFoIGRhdGEgcGVuZG9ub3IhJwogICAgICAgICAgICB9KTsKICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdGhpcy5idG5fYWRkID0gZmFsc2U7CiAgICAgICAgIH0KICAgICAgfSwKCiAgICAgIGVkaXRNb2RhbChkYXRhKSB7CiAgICAgICAgIHRoaXMuZm9ybSA9IHsKICAgICAgICAgICAgaWQ6IGRhdGEuaWQsCiAgICAgICAgICAgIHVzZXJzX2lkOiBkYXRhLnVzZXJzX2lkIHx8IG51bGwsCiAgICAgICAgICAgIG5hbWFfbGVuZ2thcDogZGF0YS5uYW1hX2xlbmdrYXAgfHwgJycsCiAgICAgICAgICAgIG5pazogZGF0YS5uaWsgfHwgJycsCiAgICAgICAgICAgIHRhbmdnYWxfbGFoaXI6IGRhdGEudGFuZ2dhbF9sYWhpciB8fCAnJywKICAgICAgICAgICAgamVuaXNfa2VsYW1pbjogZGF0YS5qZW5pc19rZWxhbWluIHx8ICcnLAogICAgICAgICAgICBlbWFpbDogZGF0YS5lbWFpbCB8fCAnJywKICAgICAgICAgICAgbm9faHA6IGRhdGEubm9faHAgfHwgJycsCiAgICAgICAgICAgIGdvbG9uZ2FuX2RhcmFoOiBkYXRhLmdvbG9uZ2FuX2RhcmFoIHx8ICcnLAogICAgICAgICAgICByaGVzdXM6IGRhdGEucmhlc3VzIHx8ICcnLAogICAgICAgICAgICBrYWJ1cGF0ZW5faWQ6IGRhdGEua2FidXBhdGVuX2lkIHx8IG51bGwsCiAgICAgICAgICAgIGtlY2FtYXRhbl9pZDogZGF0YS5rZWNhbWF0YW5faWQgfHwgbnVsbCwKICAgICAgICAgICAgZGVzX2tlbF9pZDogZGF0YS5kZXNfa2VsX2lkIHx8IG51bGwsCiAgICAgICAgICAgIGFsYW1hdDogZGF0YS5hbGFtYXQgfHwgJycsCiAgICAgICAgICAgIHJpd2F5YXRfcGVueWFraXQ6IGRhdGEucml3YXlhdF9wZW55YWtpdCB8fCBudWxsLAogICAgICAgICAgICB0ZXJha2hpcl9kb25vcjogZGF0YS50ZXJha2hpcl9kb25vciB8fCBudWxsLAogICAgICAgICAgICBmb3RvX3Byb2ZpbDogbnVsbCwKICAgICAgICAgICAgZG9rdW1lbl9wZW5kdWt1bmc6IG51bGwsCiAgICAgICAgICAgIGZvdG9fcHJvZmlsX3VybDogZGF0YS5mb3RvX3Byb2ZpbCA/ICh0aGlzLmZpbGVfcGF0aCArIGRhdGEuZm90b19wcm9maWwpIDogJycsCiAgICAgICAgICAgIGRva3VtZW5fcGVuZHVrdW5nX3VybDogZGF0YS5kb2t1bWVuX3BlbmR1a3VuZyA/ICh0aGlzLmZpbGVfcGF0aCArIGRhdGEuZG9rdW1lbl9wZW5kdWt1bmcpIDogJycsCiAgICAgICAgICAgIHN0b2tkYXJhaF9rb251dDogZGF0YS5zdG9rZGFyYWhfa29udXQgfHwgNCwKICAgICAgICAgICAgYmVyc2VkaWFfZGlwdWJsaWthc2lrYW46IGRhdGEuYmVyc2VkaWFfZGlwdWJsaWthc2lrYW4gfHwgdHJ1ZSwKICAgICAgICAgfTsKCgogICAgICAgICB0aGlzLmRhdGFrdS51c2VybmFtZSA9IGRhdGEudXNlcm5hbWUgfHwgJyc7CgogICAgICAgICBpZiAodGhpcy5mb3JtLmthYnVwYXRlbl9pZCkgewogICAgICAgICAgICB0aGlzLmxvYWRLZWNhbWF0YW4odGhpcy5mb3JtLmthYnVwYXRlbl9pZCk7CiAgICAgICAgICAgIGlmICh0aGlzLmZvcm0ua2VjYW1hdGFuX2lkKSB7CiAgICAgICAgICAgICAgIHRoaXMubG9hZERlc2tlbCh0aGlzLmZvcm0ua2VjYW1hdGFuX2lkKTsKICAgICAgICAgICAgfQogICAgICAgICB9CgogICAgICAgICB0aGlzLmRhdGFrdS5wYXNzd29yZCA9ICcnOwogICAgICAgICB0aGlzLmRhdGFrdS5jb25maXJtUGFzc3dvcmQgPSAnJzsKCiAgICAgICAgIHRoaXMubWRsX2VkaXQgPSB0cnVlOwogICAgICB9LAoKICAgICAgYXN5bmMgdXBkYXRlRGF0YSgpIHsKICAgICAgICAgdGhpcy5idG5fZWRpdCA9IHRydWU7CiAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghdGhpcy5mb3JtLm5hbWFfbGVuZ2thcCB8fCAhdGhpcy5mb3JtLnRhbmdnYWxfbGFoaXIgfHwgIXRoaXMuZm9ybS5qZW5pc19rZWxhbWluIHx8ICF0aGlzLmZvcm0uZ29sb25nYW5fZGFyYWgpIHsKICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGaWVsZCB3YWppYiAoTmFtYSwgVFRMLCBKZW5pcyBLZWxhbWluLCBHb2xvbmdhbiBEYXJhaCkgaGFydXMgZGlpc2khJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuZGF0YWt1LnVzZXJuYW1lICYmIHRoaXMuZGF0YWt1LnVzZXJuYW1lLmxlbmd0aCA8IDYpIHsKICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVc2VybmFtZSBtaW5pbWFsIDYga2FyYWt0ZXIgamlrYSBkaXViYWghJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuZm9ybS5uaWsgJiYgdGhpcy5mb3JtLm5pay5sZW5ndGggPCAxNikgewogICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05JSyBoYXJ1cyBiZXJqdW1sYWggMTYgYW5na2EhJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3Qgbm9ybWFsaXplZFRlcmFraGlyRG9ub3IgPSB0aGlzLm5vcm1hbGl6ZURhdGUodGhpcy5mb3JtLnRlcmFraGlyX2Rvbm9yKTsKICAgICAgICAgICAgY29uc3Qgbm9ybWFsaXplZFRhbmdnYWxMYWhpciA9IHRoaXMubm9ybWFsaXplRGF0ZSh0aGlzLmZvcm0udGFuZ2dhbF9sYWhpcik7CiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7CiAgICAgICAgICAgICAgIGlkOiB0aGlzLmZvcm0uaWQsCiAgICAgICAgICAgICAgIHVzZXJzX2lkOiB0aGlzLmZvcm0udXNlcnNfaWQsCiAgICAgICAgICAgICAgIG5hbWFfbGVuZ2thcDogdGhpcy5mb3JtLm5hbWFfbGVuZ2thcCwKICAgICAgICAgICAgICAgbmlrOiB0aGlzLmZvcm0ubmlrLAogICAgICAgICAgICAgICB0YW5nZ2FsX2xhaGlyOiBub3JtYWxpemVkVGFuZ2dhbExhaGlyLAogICAgICAgICAgICAgICBqZW5pc19rZWxhbWluOiB0aGlzLmZvcm0uamVuaXNfa2VsYW1pbiwKICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuZm9ybS5lbWFpbCB8fCAnJywKICAgICAgICAgICAgICAgbm9faHA6IHRoaXMuZm9ybS5ub19ocCB8fCAnJywKICAgICAgICAgICAgICAgZ29sb25nYW5fZGFyYWg6IHRoaXMuZm9ybS5nb2xvbmdhbl9kYXJhaCwKICAgICAgICAgICAgICAgcmhlc3VzOiB0aGlzLmZvcm0ucmhlc3VzIHx8ICcnLAogICAgICAgICAgICAgICBrYWJ1cGF0ZW5faWQ6IHRoaXMuZm9ybS5rYWJ1cGF0ZW5faWQgfHwgbnVsbCwKICAgICAgICAgICAgICAga2VjYW1hdGFuX2lkOiB0aGlzLmZvcm0ua2VjYW1hdGFuX2lkIHx8IG51bGwsCiAgICAgICAgICAgICAgIGRlc19rZWxfaWQ6IHRoaXMuZm9ybS5kZXNfa2VsX2lkIHx8IG51bGwsCiAgICAgICAgICAgICAgIGFsYW1hdDogdGhpcy5mb3JtLmFsYW1hdCB8fCAnJywKICAgICAgICAgICAgICAgcml3YXlhdF9wZW55YWtpdDogdGhpcy5mb3JtLnJpd2F5YXRfcGVueWFraXQgfHwgJycsCiAgICAgICAgICAgICAgIHRlcmFraGlyX2Rvbm9yOiBub3JtYWxpemVkVGVyYWtoaXJEb25vciwKICAgICAgICAgICAgICAgc3Rva2RhcmFoX2tvbnV0OiB0aGlzLmZvcm0uc3Rva2RhcmFoX2tvbnV0IHx8IDQsCiAgICAgICAgICAgICAgIGJlcnNlZGlhX2RpcHVibGlrYXNpa2FuOiB0aGlzLmZvcm0uYmVyc2VkaWFfZGlwdWJsaWthc2lrYW4gPyAxIDogMCwKICAgICAgICAgICAgICAgdXNlcm5hbWU6IHRoaXMuZGF0YWt1LnVzZXJuYW1lIHx8ICcnLAogICAgICAgICAgICB9OwoKICAgICAgICAgICAgY29uc3QgaGFzTmV3RmlsZSA9ICh0aGlzLmZvcm0uZm90b19wcm9maWwgJiYgdGhpcy5mb3JtLmZvdG9fcHJvZmlsIGluc3RhbmNlb2YgRmlsZSkgfHwKICAgICAgICAgICAgICAgKHRoaXMuZm9ybS5kb2t1bWVuX3BlbmR1a3VuZyAmJiB0aGlzLmZvcm0uZG9rdW1lbl9wZW5kdWt1bmcgaW5zdGFuY2VvZiBGaWxlKTsKCiAgICAgICAgICAgIGxldCByZXNwb25zZSwgcmVzdWx0OwoKICAgICAgICAgICAgaWYgKGhhc05ld0ZpbGUpIHsKICAgICAgICAgICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gcGF5bG9hZCkgewogICAgICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoa2V5LCBwYXlsb2FkW2tleV0gfHwgJycpOwogICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgIC8vIEFwcGVuZCBmaWxlcyBqaWthIGFkYQogICAgICAgICAgICAgICBpZiAodGhpcy5mb3JtLmZvdG9fcHJvZmlsICYmIHRoaXMuZm9ybS5mb3RvX3Byb2ZpbCBpbnN0YW5jZW9mIEZpbGUpIHsKICAgICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdmb3RvX3Byb2ZpbCcsIHRoaXMuZm9ybS5mb3RvX3Byb2ZpbCk7CiAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHRoaXMuZm9ybS5kb2t1bWVuX3BlbmR1a3VuZyAmJiB0aGlzLmZvcm0uZG9rdW1lbl9wZW5kdWt1bmcgaW5zdGFuY2VvZiBGaWxlKSB7CiAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnZG9rdW1lbl9wZW5kdWt1bmcnLCB0aGlzLmZvcm0uZG9rdW1lbl9wZW5kdWt1bmcpOwogICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICByZXNwb25zZSA9IGF3YWl0IGZldGNoKHRoaXMuJHN0b3JlLnN0YXRlLnVybC5SRUdJU19ET05PUiArICJlZGl0RGF0YSIsIHsKICAgICAgICAgICAgICAgICAgbWV0aG9kOiAiUE9TVCIsCiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICAgYXV0aG9yaXphdGlvbjogImtpa2Vuc2JhdGFyYSAiICsgbG9jYWxTdG9yYWdlLnRva2VuCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGJvZHk6IGZvcm1EYXRhCiAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICByZXN1bHQgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgIHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godGhpcy4kc3RvcmUuc3RhdGUudXJsLlJFR0lTX0RPTk9SICsgImVkaXREYXRhIiwgewogICAgICAgICAgICAgICAgICBtZXRob2Q6ICJQT1NUIiwKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgICAgICAgICAgICAgICBhdXRob3JpemF0aW9uOiAia2lrZW5zYmF0YXJhICIgKyBsb2NhbFN0b3JhZ2UudG9rZW4KICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocGF5bG9hZCkKICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgIHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm9rICYmIHJlc3VsdC5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgIHRoaXMuJHEubm90aWZ5KHsKICAgICAgICAgICAgICAgICAgdHlwZTogInBvc2l0aXZlIiwKICAgICAgICAgICAgICAgICAgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2UgfHwgIkRhdGEgcGVuZG9ub3IgYmVyaGFzaWwgZGl1cGRhdGUiCiAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgdGhpcy5tZGxfZWRpdCA9IGZhbHNlOwogICAgICAgICAgICAgICB0aGlzLmdldFZpZXcoKTsKICAgICAgICAgICAgICAgdGhpcy5yZXNldEZvcm0oKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlc3VsdC5tZXNzYWdlIHx8ICJHYWdhbCBtZW5ndXBkYXRlIGRhdGEgcGVuZG9ub3IiKTsKICAgICAgICAgICAgfQogICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciB1cGRhdGUgZGF0YSBwZW5kb25vcjoiLCBlcnJvcik7CiAgICAgICAgICAgIHRoaXMuJHEubm90aWZ5KHsKICAgICAgICAgICAgICAgdHlwZTogIm5lZ2F0aXZlIiwKICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAiVGVyamFkaSBrZXNhbGFoYW4gc2FhdCB1cGRhdGUgZGF0YSBwZW5kb25vciIKICAgICAgICAgICAgfSk7CiAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHRoaXMuYnRuX2VkaXQgPSBmYWxzZTsKICAgICAgICAgfQogICAgICB9LAoKICAgICAgcmVzZXRGb3JtKCkgewogICAgICAgICB0aGlzLmZvcm0gPSB7CiAgICAgICAgICAgIGlkOiBudWxsLAogICAgICAgICAgICB1c2Vyc19pZDogbnVsbCwKICAgICAgICAgICAgbmFtYV9sZW5na2FwOiAnJywKICAgICAgICAgICAgbmlrOiAnJywKICAgICAgICAgICAgdGFuZ2dhbF9sYWhpcjogJycsCiAgICAgICAgICAgIGplbmlzX2tlbGFtaW46ICcnLAogICAgICAgICAgICBnb2xvbmdhbl9kYXJhaDogJycsCiAgICAgICAgICAgIHJoZXN1czogJycsCiAgICAgICAgICAgIGthYnVwYXRlbl9pZDogbnVsbCwKICAgICAgICAgICAga2VjYW1hdGFuX2lkOiBudWxsLAogICAgICAgICAgICBkZXNfa2VsX2lkOiBudWxsLAogICAgICAgICAgICBhbGFtYXQ6ICcnLAogICAgICAgICAgICBlbWFpbDogJycsCiAgICAgICAgICAgIG5vX2hwOiAnJywKICAgICAgICAgICAgcml3YXlhdF9wZW55YWtpdDogJycsCiAgICAgICAgICAgIHRlcmFraGlyX2Rvbm9yOiAnJywKICAgICAgICAgICAgZm90b19wcm9maWw6IG51bGwsCiAgICAgICAgICAgIGRva3VtZW5fcGVuZHVrdW5nOiBudWxsLAogICAgICAgICAgICBmb3RvX3Byb2ZpbF91cmw6ICcnLAogICAgICAgICAgICBkb2t1bWVuX3BlbmR1a3VuZ191cmw6ICcnLAogICAgICAgICAgICBzdG9rZGFyYWhfa29udXQ6IDQsCiAgICAgICAgICAgIGJlcnNlZGlhX2RpcHVibGlrYXNpa2FuOiB0cnVlLAogICAgICAgICB9OwogICAgICAgICB0aGlzLmRhdGFrdSA9IHsKICAgICAgICAgICAgdXNlcm5hbWU6ICcnLAogICAgICAgICAgICBwYXNzd29yZDogJycsCiAgICAgICAgICAgIGNvbmZpcm1QYXNzd29yZDogJycKICAgICAgICAgfTsKICAgICAgICAgdGhpcy5rZWNhbWF0YW5PcHRpb25zID0gW107CiAgICAgICAgIHRoaXMuZGVza2VsT3B0aW9ucyA9IFtdOwogICAgICAgICB0aGlzLmVycm9yTWVzc2FnZSA9ICcnOwogICAgICB9LAoKICAgICAgYXN5bmMgaGFwdXNEYXRhKCkgewogICAgICAgICAvLyBWYWxpZGFzaSBJRCB3YWppYgogICAgICAgICBpZiAoIXRoaXMuZm9ybS5pZCB8fCAhdGhpcy5mb3JtLnVzZXJzX2lkKSB7CiAgICAgICAgICAgIHRoaXMuJHEubm90aWZ5KHsKICAgICAgICAgICAgICAgdHlwZTogJ25lZ2F0aXZlJywKICAgICAgICAgICAgICAgbWVzc2FnZTogJ0RhdGEgdGlkYWsgdmFsaWQuIFNpbGFrYW4gcGlsaWggdWxhbmcuJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5yZXNldEhhcHVzRm9ybSgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KCiAgICAgICAgIHRoaXMuYnRuX2hhcHVzID0gdHJ1ZTsKICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHsKICAgICAgICAgICAgICAgaWQ6IHRoaXMuZm9ybS5pZCwKICAgICAgICAgICAgICAgdXNlcnNfaWQ6IHRoaXMuZm9ybS51c2Vyc19pZAogICAgICAgICAgICB9OwoKICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh0aGlzLiRzdG9yZS5zdGF0ZS51cmwuUkVHSVNfRE9OT1IgKyAicmVtb3ZlUGVuZG9ub3IiLCB7CiAgICAgICAgICAgICAgIG1ldGhvZDogIlBPU1QiLAogICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgICAgICAgICAgIGF1dGhvcml6YXRpb246ICJraWtlbnNiYXRhcmEgIiArIGxvY2FsU3RvcmFnZS50b2tlbgogICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShwYXlsb2FkKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNvbnN0IHJlc19kYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpOwoKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm9rICYmIHJlc19kYXRhLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgdGhpcy4kcS5ub3RpZnkoewogICAgICAgICAgICAgICAgICB0eXBlOiAncG9zaXRpdmUnLAogICAgICAgICAgICAgICAgICBtZXNzYWdlOiByZXNfZGF0YS5tZXNzYWdlIHx8ICdEYXRhIHBlbmRvbm9yIGJlcmhhc2lsIGRpaGFwdXMnCiAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICB0aGlzLm1kbF9oYXB1cyA9IGZhbHNlOwogICAgICAgICAgICAgICB0aGlzLmdldFZpZXcoKTsKICAgICAgICAgICAgICAgdGhpcy5yZXNldEZvcm0oKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlc19kYXRhLm1lc3NhZ2UgfHwgJ0dhZ2FsIG1lbmdoYXB1cyBkYXRhJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaGFwdXMgZGF0YTonLCBlcnJvcik7CiAgICAgICAgICAgIHRoaXMuJHEubm90aWZ5KHsKICAgICAgICAgICAgICAgdHlwZTogJ25lZ2F0aXZlJywKICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnVGVyamFkaSBrZXNhbGFoYW4gc2FhdCBtZW5naGFwdXMgZGF0YScKICAgICAgICAgICAgfSk7CiAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHRoaXMuYnRuX2hhcHVzID0gZmFsc2U7CiAgICAgICAgIH0KICAgICAgfSwKCgogICAgICBhc3luYyBlZGl0RGF0YVBhc3N3b3JkKCkgewogICAgICAgICB0aGlzLmVycm9yTWVzc2FnZSA9ICcnOwoKICAgICAgICAgaWYgKCF0aGlzLmRhdGFrdS5wYXNzd29yZCB8fCAhdGhpcy5kYXRha3UuY29uZmlybVBhc3N3b3JkKSB7CiAgICAgICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gIlBhc3N3b3JkIGRhbiBDb25maXJtIFBhc3N3b3JkIHdhamliIGRpaXNpISI7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQoKICAgICAgICAgaWYgKHRoaXMuZGF0YWt1LnBhc3N3b3JkLmxlbmd0aCA8IDYpIHsKICAgICAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSAiUGFzc3dvcmQgbWluaW1hbCA2IGthcmFrdGVyISI7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQoKICAgICAgICAgaWYgKHRoaXMuZGF0YWt1LnBhc3N3b3JkICE9PSB0aGlzLmRhdGFrdS5jb25maXJtUGFzc3dvcmQpIHsKICAgICAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSAiUGFzc3dvcmQgZGFuIENvbmZpcm0gUGFzc3dvcmQgdGlkYWsgc2FtYSEiOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KCiAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKHRoaXMuJHN0b3JlLnN0YXRlLnVybC5SRUdJU19ET05PUiArICJlZGl0UGFzc3dvcmRQZW5kb25vciIsIHsKICAgICAgICAgICAgICAgbWV0aG9kOiAiUE9TVCIsCiAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAgICAgICAgICAgYXV0aG9yaXphdGlvbjogImtpa2Vuc2JhdGFyYSAiICsgbG9jYWxTdG9yYWdlLnRva2VuCiAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgICAgdXNlcnNfaWQ6IHRoaXMuZGF0YWt1LnVzZXJzX2lkLAogICAgICAgICAgICAgICAgICBwYXNzd29yZDogdGhpcy5kYXRha3UucGFzc3dvcmQKICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzLmpzb24oKTsKCiAgICAgICAgICAgIGlmIChyZXMub2sgJiYgZGF0YS5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgIHRoaXMuJHEubm90aWZ5KHsgdHlwZTogInBvc2l0aXZlIiwgbWVzc2FnZTogZGF0YS5tZXNzYWdlIHx8ICJQYXNzd29yZCBiZXJoYXNpbCBkaXViYWghIiB9KTsKICAgICAgICAgICAgICAgdGhpcy5tZGxfcGFzc3dvcmQgPSBmYWxzZTsKICAgICAgICAgICAgICAgdGhpcy5kYXRha3UucGFzc3dvcmQgPSAnJzsKICAgICAgICAgICAgICAgdGhpcy5kYXRha3UuY29uZmlybVBhc3N3b3JkID0gJyc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gZGF0YS5tZXNzYWdlIHx8ICJHYWdhbCBtZW5ndWJhaCBwYXNzd29yZCEiOwogICAgICAgICAgICB9CiAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgICAgICB0aGlzLmVycm9yTWVzc2FnZSA9ICJUZXJqYWRpIGtlc2FsYWhhbiBzYWF0IG1lbmd1YmFoIHBhc3N3b3JkLiI7CiAgICAgICAgIH0KICAgICAgfSwKICAgICAgc2VsZWN0RGF0YShkYXRhKSB7CiAgICAgICAgIHRoaXMuZGF0YWt1ID0gewogICAgICAgICAgICB1c2Vyc19pZDogZGF0YS51c2Vyc19pZCwKICAgICAgICAgICAgcGFzc3dvcmQ6ICcnLAogICAgICAgICAgICBjb25maXJtUGFzc3dvcmQ6ICcnCiAgICAgICAgIH07CiAgICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gJyc7CiAgICAgICAgIHRoaXMuZm9ybSA9IHsKICAgICAgICAgICAgLi4uZGF0YSwKICAgICAgICAgICAgdXNlcnNfaWQ6IGRhdGEudXNlcnNfaWQsCiAgICAgICAgICAgIGlkOiBkYXRhLmlkCiAgICAgICAgIH07CiAgICAgICAgIHRoaXMubGloYXREYXRhID0gewogICAgICAgICAgICBuYW1hX2xlbmdrYXA6IGRhdGEubmFtYV9sZW5na2FwIHx8ICcnLAogICAgICAgICAgICBuaWs6IGRhdGEubmlrIHx8ICcnLAogICAgICAgICAgICB0YW5nZ2FsX2xhaGlyOiBkYXRhLnRhbmdnYWxfbGFoaXIgfHwgJycsCiAgICAgICAgICAgIGplbmlzX2tlbGFtaW46IGRhdGEuamVuaXNfa2VsYW1pbiB8fCAnJywKICAgICAgICAgICAgZ29sb25nYW5fZGFyYWg6IGRhdGEuZ29sb25nYW5fZGFyYWggfHwgJycsCiAgICAgICAgICAgIHJoZXN1czogZGF0YS5yaGVzdXMgfHwgJycsCiAgICAgICAgICAgIGVtYWlsOiBkYXRhLmVtYWlsIHx8ICcnLAogICAgICAgICAgICBub19ocDogZGF0YS5ub19ocCB8fCAnJywKICAgICAgICAgICAgYWxhbWF0OiBkYXRhLmFsYW1hdCB8fCAnJywKICAgICAgICAgICAgcml3YXlhdF9wZW55YWtpdDogZGF0YS5yaXdheWF0X3Blbnlha2l0IHx8ICcnLAogICAgICAgICAgICB0ZXJha2hpcl9kb25vcjogZGF0YS50ZXJha2hpcl9kb25vciB8fCAnJywKICAgICAgICAgICAga2FidXBhdGVuX25hbWE6IGRhdGEua2FidXBhdGVuX25hbWEgfHwgJycsICAvLyBBc3Vtc2kgZGFyaSBiYWNrZW5kOyBqaWthIElEIHNhamEsIGZldGNoIGRpIHNpbmkKICAgICAgICAgICAga2VjYW1hdGFuX25hbWE6IGRhdGEua2VjYW1hdGFuX25hbWEgfHwgJycsCiAgICAgICAgICAgIGRlc19rZWxfbmFtYTogZGF0YS5kZXNfa2VsX25hbWEgfHwgJycsCiAgICAgICAgICAgIGZvdG9fcHJvZmlsOiBkYXRhLmZvdG9fcHJvZmlsIHx8ICcnLAogICAgICAgICAgICBkb2t1bWVuX3BlbmR1a3VuZzogZGF0YS5kb2t1bWVuX3BlbmR1a3VuZyB8fCAnJywKICAgICAgICAgICAgdXNlcm5hbWU6IGRhdGEudXNlcm5hbWUgfHwgJycsCiAgICAgICAgICAgIHVzZXJzX2lkOiBkYXRhLnVzZXJzX2lkIHx8ICcnLAogICAgICAgICAgICBpZDogZGF0YS5pZCB8fCAnJywKICAgICAgICAgfTsKICAgICAgfSwKCiAgICAgIHJlc2V0UGFzc3dvcmRGb3JtKCkgewogICAgICAgICB0aGlzLmRhdGFrdS5wYXNzd29yZCA9ICcnOwogICAgICAgICB0aGlzLmRhdGFrdS5jb25maXJtUGFzc3dvcmQgPSAnJzsKICAgICAgICAgdGhpcy5kYXRha3UudXNlcnNfaWQgPSBudWxsOwogICAgICAgICB0aGlzLmlzUHdkID0gdHJ1ZTsKICAgICAgICAgdGhpcy5pc1B3ZDIgPSB0cnVlOwogICAgICAgICB0aGlzLmJ0bl9wYXNzd29yZCA9IGZhbHNlOwogICAgICAgICB0aGlzLm1kbF9wYXNzd29yZCA9IGZhbHNlOwogICAgICB9LAoKICAgICAgcmVzZXRIYXB1c0Zvcm0oKSB7CiAgICAgICAgIHRoaXMuZm9ybS5pZCA9IG51bGw7CiAgICAgICAgIHRoaXMuZm9ybS51c2Vyc19pZCA9IG51bGw7CiAgICAgICAgIHRoaXMuYnRuX2hhcHVzID0gZmFsc2U7CiAgICAgICAgIHRoaXMubWRsX2hhcHVzID0gZmFsc2U7CiAgICAgIH0sCgoKCiAgICAgIGluZGV4aW5nKGlkeCkgewogICAgICAgICByZXR1cm4gKCh0aGlzLnBhZ2VfZmlyc3QgLSAxKSAqIHRoaXMucGFnZV9saW1pdCkgKyBpZHg7CiAgICAgIH0sCgogICAgICBub3JtYWxpemVEYXRlKGRhdGVTdHIpIHsKICAgICAgICAgaWYgKCFkYXRlU3RyIHx8IGRhdGVTdHIgPT09ICcnKSByZXR1cm4gJyc7CiAgICAgICAgIGlmICgvXlxkezR9LVxkezJ9LVxkezJ9JC8udGVzdChkYXRlU3RyKSkgcmV0dXJuIGRhdGVTdHI7CiAgICAgICAgIGlmIChkYXRlU3RyLmluY2x1ZGVzKCdUJykpIHJldHVybiBkYXRlU3RyLnNwbGl0KCdUJylbMF07CiAgICAgICAgIHJldHVybiAnJzsKICAgICAgfSwKCiAgICAgIGNhcmlfZGF0YSgpIHsgdGhpcy5wYWdlX2ZpcnN0ID0gMTsgdGhpcy5nZXRWaWV3KCk7IH0sCiAgICAgIG9wZW5Gb3RvKCkgewogICAgICAgICBpZiAodGhpcy5saWhhdERhdGEuZm90b19wcm9maWwpIHsKICAgICAgICAgICAgY29uc3QgdXJsID0gdGhpcy5maWxlX3BhdGggKyB0aGlzLmxpaGF0RGF0YS5mb3RvX3Byb2ZpbDsKICAgICAgICAgICAgd2luZG93Lm9wZW4odXJsLCAnX2JsYW5rJyk7CiAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuJHEubm90aWZ5KHsgdHlwZTogJ25lZ2F0aXZlJywgbWVzc2FnZTogJ0ZvdG8gdGlkYWsgdGVyc2VkaWEnIH0pOwogICAgICAgICB9CiAgICAgIH0sCiAgICAgIG9wZW5Eb2t1bWVuKCkgewogICAgICAgICBpZiAodGhpcy5saWhhdERhdGEuZG9rdW1lbl9wZW5kdWt1bmcpIHsKICAgICAgICAgICAgY29uc3QgdXJsID0gdGhpcy5maWxlX3BhdGggKyB0aGlzLmxpaGF0RGF0YS5kb2t1bWVuX3BlbmR1a3VuZzsKICAgICAgICAgICAgd2luZG93Lm9wZW4odXJsLCAnX2JsYW5rJyk7CiAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuJHEubm90aWZ5KHsgdHlwZTogJ25lZ2F0aXZlJywgbWVzc2FnZTogJ0Rva3VtZW4gdGlkYWsgdGVyc2VkaWEnIH0pOwogICAgICAgICB9CiAgICAgIH0sCiAgICAgIGhhbmRsZUltYWdlRXJyb3IoZXZlbnQpIHsKICAgICAgICAgZXZlbnQudGFyZ2V0LnNyYyA9ICdwYXRoL3RvL3BsYWNlaG9sZGVyLWltYWdlLmpwZyc7ICAvLyBHYW50aSBkZW5nYW4gVVJMIHBsYWNlaG9sZGVyIGRlZmF1bHQsIGF0YXUga29zb25na2FuIHNyYwogICAgICAgICAvLyBBdGF1OiBldmVudC50YXJnZXQuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgdW50dWsgc2VtYnVueWlrYW4gaW1nIHJ1c2FrCiAgICAgIH0sCgogICAgICBhc3luYyBvcGVuUml3YXlhdChwZW5kb25vcikgewogIHRoaXMuY3VycmVudFBlbmRvbm9yID0gcGVuZG9ub3IgfHwge307CiAgdGhpcy5yaXdheWF0TGlzdCA9IFtdOwogIHRoaXMubWRsX3Jpd2F5YXQgPSB0cnVlOwogIHRoaXMucml3YXlhdExvYWRpbmcgPSB0cnVlOwoKICBjb25zdCBwZW5kb25vcklkID0gcGVuZG9ub3IgJiYgKHBlbmRvbm9yLmlkIHx8IHBlbmRvbm9yLnBlbmRvbm9yX2lkIHx8IHBlbmRvbm9yLnVzZXJzX2lkIHx8IHBlbmRvbm9yLnVzZXJfaWQpOwogIGlmICghcGVuZG9ub3JJZCkgewogICAgdGhpcy4kcS5ub3RpZnkoeyB0eXBlOiAnbmVnYXRpdmUnLCBtZXNzYWdlOiAnSUQgcGVuZG9ub3IgdGlkYWsgZGl0ZW11a2FuJyB9KTsKICAgIHRoaXMucml3YXlhdExvYWRpbmcgPSBmYWxzZTsKICAgIHJldHVybjsKICB9CgogIHRyeSB7CiAgICAvLyAxKSBDb2JhIGVuZHBvaW50IGpvaW4geWFuZyBlZmlzaWVuIChzZXN1YWlrYW4gbmFtYSBlbmRwb2ludCBrYWxhdSBiZWRhKQogICAgY29uc3QgdXJsSm9pbiA9IHRoaXMuJHN0b3JlLnN0YXRlLnVybC5KQURXQUxfRE9OT1IgKyAiZ2V0SGlzdG9yeUJ5UGVuZG9ub3IiOwogICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2godXJsSm9pbiwgewogICAgICBtZXRob2Q6ICJQT1NUIiwKICAgICAgaGVhZGVyczogewogICAgICAgICJjb250ZW50LXR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgYXV0aG9yaXphdGlvbjogImtpa2Vuc2JhdGFyYSAiICsgbG9jYWxTdG9yYWdlLnRva2VuCiAgICAgIH0sCiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgcGVuZG9ub3JfaWQ6IHBlbmRvbm9ySWQgfSkKICAgIH0pOwogICAgY29uc3QganNvbiA9IGF3YWl0IHJlcy5qc29uKCk7CgogICAgaWYgKGpzb24gJiYgQXJyYXkuaXNBcnJheShqc29uLmRhdGEpICYmIGpzb24uZGF0YS5sZW5ndGgpIHsKICAgICAgdGhpcy5yaXdheWF0TGlzdCA9IGpzb24uZGF0YS5tYXAoaXQgPT4gKHsKICAgICAgICBqYWR3YWxfaWQ6IGl0LmphZHdhbF9pZCB8fCBpdC5pZCB8fCBpdC5qYWR3YWxfaWQsCiAgICAgICAgbmFtYV9rZWdpYXRhbjogaXQubmFtYV9rZWdpYXRhbiB8fCBpdC5uYW1hIHx8IGl0Lmp1ZHVsLAogICAgICAgIHRhbmdnYWxfbXVsYWk6IGl0LnRhbmdnYWxfbXVsYWksCiAgICAgICAgdGFuZ2dhbF9zZWxlc2FpOiBpdC50YW5nZ2FsX3NlbGVzYWksCiAgICAgICAgbG9rYXNpOiBpdC5sb2thc2kKICAgICAgfSkpOwogICAgICB0aGlzLnJpd2F5YXRMb2FkaW5nID0gZmFsc2U7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyAyKSBGYWxsYmFjazogYW1iaWwgamFkd2FsX3Blc2VydGEgKGxpc3QgamFkd2FsX2lkKSBsYWx1IGFtYmlsIGphZHdhbF9kb25vciBwZXIgaWQKICAgIGNvbnN0IHVybExpc3QgPSB0aGlzLiRzdG9yZS5zdGF0ZS51cmwuUkVHSVNfRE9OT1IgKyAiZ2V0QnlQZW5kb25vciI7IC8vIHNlc3VhaWthbiBuYW1hIGVuZHBvaW50CiAgICBjb25zdCByZXMyID0gYXdhaXQgZmV0Y2godXJsTGlzdCwgewogICAgICBtZXRob2Q6ICJQT1NUIiwKICAgICAgaGVhZGVyczogewogICAgICAgICJjb250ZW50LXR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgYXV0aG9yaXphdGlvbjogImtpa2Vuc2JhdGFyYSAiICsgbG9jYWxTdG9yYWdlLnRva2VuCiAgICAgIH0sCiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgcGVuZG9ub3JfaWQ6IHBlbmRvbm9ySWQgfSkKICAgIH0pOwogICAgY29uc3QganNvbjIgPSBhd2FpdCByZXMyLmpzb24oKTsKICAgIGNvbnN0IGxpc3QgPSBqc29uMi5kYXRhIHx8IFtdOwoKICAgIGlmICghQXJyYXkuaXNBcnJheShsaXN0KSB8fCAhbGlzdC5sZW5ndGgpIHsKICAgICAgdGhpcy5yaXdheWF0TGlzdCA9IFtdOwogICAgICB0aGlzLnJpd2F5YXRMb2FkaW5nID0gZmFsc2U7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBqYWR3YWxJZHMgPSBbLi4ubmV3IFNldChsaXN0Lm1hcCh4ID0+IHguamFkd2FsX2lkIHx8IHguamFkd2FsIHx8IHguaWRfamFkd2FsKS5maWx0ZXIoQm9vbGVhbikpXTsKCiAgICAvLyBmZXRjaCBkZXRhaWxzIHBhcmFsZWwgKHNlc3VhaWthbiBlbmRwb2ludCBnZXRCeUlkIGppa2EgYmVkYSkKICAgIGNvbnN0IGZldGNoZXMgPSBqYWR3YWxJZHMubWFwKGlkID0+CiAgICAgIGZldGNoKHRoaXMuJHN0b3JlLnN0YXRlLnVybC5KQURXQUxfRE9OT1IgKyAiZ2V0QnlJZCIsIHsKICAgICAgICBtZXRob2Q6ICJQT1NUIiwKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAiY29udGVudC10eXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgICAgYXV0aG9yaXphdGlvbjogImtpa2Vuc2JhdGFyYSAiICsgbG9jYWxTdG9yYWdlLnRva2VuCiAgICAgICAgfSwKICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGlkIH0pCiAgICAgIH0pCiAgICAgICAgLnRoZW4ociA9PiByLmpzb24oKSkKICAgICAgICAudGhlbihyaiA9PiByai5kYXRhIHx8IG51bGwpCiAgICAgICAgLmNhdGNoKGVyciA9PiB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBmZXRjaGluZyBqYWR3YWwgaWQiLCBpZCwgZXJyKTsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0pCiAgICApOwoKICAgIGNvbnN0IGphZHdhbERldGFpbHMgPSBhd2FpdCBQcm9taXNlLmFsbChmZXRjaGVzKTsKCiAgICB0aGlzLnJpd2F5YXRMaXN0ID0gamFkd2FsRGV0YWlscwogICAgICAuZmlsdGVyKEJvb2xlYW4pCiAgICAgIC5tYXAoZCA9PiAoewogICAgICAgIGphZHdhbF9pZDogZC5pZCwKICAgICAgICBuYW1hX2tlZ2lhdGFuOiBkLm5hbWFfa2VnaWF0YW4gfHwgZC5qdWR1bCB8fCAnLScsCiAgICAgICAgdGFuZ2dhbF9tdWxhaTogZC50YW5nZ2FsX211bGFpLAogICAgICAgIHRhbmdnYWxfc2VsZXNhaTogZC50YW5nZ2FsX3NlbGVzYWksCiAgICAgICAgbG9rYXNpOiBkLmxva2FzaQogICAgICB9KSk7CgogICAgdGhpcy5yaXdheWF0TG9hZGluZyA9IGZhbHNlOwogIH0gY2F0Y2ggKGVycikgewogICAgY29uc29sZS5lcnJvcigi4p2MIEVycm9yIG9wZW5SaXdheWF0OiIsIGVycik7CiAgICB0aGlzLiRxLm5vdGlmeSh7IHR5cGU6ICJuZWdhdGl2ZSIsIG1lc3NhZ2U6ICJHYWdhbCBtZW11YXQgcml3YXlhdCBkb25vciIgfSk7CiAgICB0aGlzLnJpd2F5YXRMb2FkaW5nID0gZmFsc2U7CiAgfQp9CgoKCiAgIH0sCiAgIG1vdW50ZWQoKSB7CiAgICAgIHRoaXMuZ2V0VmlldygpOwogICAgICB0aGlzLmxvYWRLYWJ1cGF0ZW4oKTsKICAgfQp9Cg=="},{"version":3,"sources":["regisPendonor.vue"],"names":[],"mappings":";AA8pBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA","file":"regisPendonor.vue","sourceRoot":"src/views/dataMaster","sourcesContent":["<template>\n   <div class=\"about\" style=\"padding:15px\">\n      <q-card bordered class=\"my-card\">\n         <q-card-section class=\"main2 text-white\">\n            <div class=\"row\">\n               <div class=\"col-12 col-md-6\">\n                  <div class=\"text-h6 h_titleHead\">Registrasi Pendonor</div>\n                  <!-- <div class=\"text-subtitle2\">Program/Kegiatan</div> -->\n               </div>\n               <div class=\"col-12 col-md-2\"></div>\n               <div class=\"col-12 col-md-4\">\n                  <div class=\"row\">\n                     <q-input v-model=\"cari_value\" @keyup=\"cari_data()\" outlined square :dense=\"true\" class=\"bg-white\"\n                        style=\"width:90%\" />\n                     <q-btn glossy class=\"main1x\" @click=\"mdl_add = true\" dense flat icon=\"add\" style=\"width:10%\">\n                        <q-tooltip content-class=\"bg-blue-9\" content-style=\"font-size: 13px\">\n                           Click untuk menambah data\n                        </q-tooltip>\n                     </q-btn>\n                  </div>\n\n               </div>\n            </div>\n         </q-card-section>\n\n         <q-separator dark inset />\n\n         <q-card-section>\n            <!-- <hr class=\"hrpagin2\"> -->\n\n\n            <hr class=\"hrpagin2\">\n            <div class=\"tbl_responsive\">\n               <table width=\"100%\">\n                  <thead class=\"h_table_head main2x text-white\">\n                     <tr>\n                        <th width=\"5%\" class=\"text-center\">No</th>\n                        <th width=\"20%\">Nama Lengkap</th>\n                        <th width=\"10%\">NIK</th>\n                        <th width=\"15%\">TTL</th>\n                        <th width=\"10%\">Golongan Darah</th>\n                        <th width=\"10%\">No HP</th>\n                        <th width=\"10%\">Jenis Kelamin</th>\n                        <th width=\"10%\">username</th>\n                        <th width=\"10%\" class=\"text-center\">Aksi</th>\n                     </tr>\n                  </thead>\n                  <tbody>\n                     <tr v-for=\"(data, index) in list_data\" :key=\"data.id + '-' + index\">\n                        <td class=\"text-center\">{{ indexing(index + 1) }}</td>\n\n                        <td>{{ data.nama_lengkap }}</td>\n                        <td>{{ data.nik }}</td>\n                        <td>{{ UMUM.tglConvert(data.tanggal_lahir) }}</td>\n                        <td>{{ data.golongan_darah }}</td>\n                        <td>{{ data.no_hp }}</td>\n                        <td>{{ data.jenis_kelamin }}</td>\n                        <td>{{ data.username }}</td>\n                        <td class=\"text-center\">\n                           <q-item-section>\n                              <div class=\"text-white q-gutter-xs text-center\">\n                                 <q-btn size=\"12px\" dense glossy round icon=\"settings\" class=\"main1x\">\n                                    <q-menu>\n                                       <q-list dense style=\"min-width: 100px\">\n                                          <q-item clickable v-close-popup @click=\"openRiwayat(data)\">\n                                             <q-item-section>Riwayat Donor</q-item-section>\n                                          </q-item>\n                                          <q-separator />\n\n                                          <q-item clickable v-close-popup @click=\"mdl_lihat = true, selectData(data)\">\n                                             <q-item-section>Lihat Detail</q-item-section>\n                                          </q-item>\n                                          <q-separator />\n                                          <q-item clickable v-close-popup\n                                             @click=\"mdl_password = true, selectData(data)\">\n                                             <q-item-section>Edit Password</q-item-section>\n                                          </q-item>\n                                          <q-separator />\n                                          <q-item clickable v-close-popup @click=\"editModal(data)\">\n                                             <q-item-section>Edit</q-item-section>\n                                          </q-item>\n                                          <q-separator />\n                                          <q-item clickable v-close-popup @click=\"mdl_hapus = true, selectData(data)\">\n                                             <q-item-section>Hapus</q-item-section>\n                                          </q-item>\n                                          <q-separator />\n                                       </q-list>\n                                    </q-menu>\n                                 </q-btn>\n                              </div>\n                           </q-item-section>\n                        </td>\n\n                     </tr>\n                  </tbody>\n               </table>\n            </div>\n\n            <div class=\"flex flex-center q-mt-md\">\n               <q-pagination v-model=\"page_first\" :max=\"page_last\" @update:model-value=\"getView()\" color=\"grey-6\"\n                  :max-pages=\"4\" :direction-links=\"true\" :boundary-links=\"true\" />\n            </div>\n         </q-card-section>\n      </q-card>\n\n      <!-- ===================== MODAL ADD ===================== -->\n      <q-dialog v-model=\"mdl_add\" persistent>\n         <q-card class=\"mdl-md\">\n            <q-card-section class=\"main2 text-white\">\n               <div class=\"text-h6 h_modalhead\">Tambah Pendonor</div>\n            </q-card-section>\n\n            <form @submit.prevent=\"addData()\">\n\n               <q-card-section class=\"q-pt-none\">\n\n                  <hr class=\"hrpagin2\">\n\n                  <span class=\"h_lable\">Nama Lengkap</span>\n                  <q-input v-model=\"form.nama_lengkap\" outlined square required :dense=\"true\"\n                     class=\"bg-white margin_btn\" />\n\n                  <span class=\"h_lable\">NIK</span>\n                  <q-input v-model=\"form.nik\" outlined square required :dense=\"true\" class=\"bg-white margin_btn\" />\n\n                  <div class=\"row q-col-gutter-md\">\n                     <div class=\"col-6\">\n                        <span class=\"h_lable\">Tanggal Lahir</span>\n                        <q-input v-model=\"form.tanggal_lahir\" type=\"date\" outlined required square :dense=\"true\"\n                           class=\"bg-white margin_btn\" />\n                     </div>\n\n                     <div class=\"col-6\">\n                        <span class=\"h_lable\">Jenis Kelamin</span>\n                        <q-select v-model=\"form.jenis_kelamin\" :options=\"[\n                        { label: 'Laki-laki', value: 'L' },\n                        { label: 'Perempuan', value: 'P' }\n                     ]\" outlined emit-value map-options required square :dense=\"true\" class=\"bg-white margin_btn\" />\n                     </div>\n                  </div>\n\n                  <div class=\"row q-col-gutter-md\">\n                     <div class=\"col-6\">\n                        <span class=\"h_lable\">Email</span>\n                        <q-input v-model=\"form.email\" type=\"email\" outlined square :dense=\"true\"\n                           class=\"bg-white margin_btn\" />\n                     </div>\n\n                     <div class=\"col-6\">\n                        <span class=\"h_lable\">No HP</span>\n                        <q-input v-model=\"form.no_hp\" type=\"tel\" outlined square :dense=\"true\" required\n                           class=\"bg-white margin_btn\" />\n\n                     </div>\n                  </div>\n                  <div class=\"row q-col-gutter-md\">\n                     <div class=\"col-6\">\n                        <span class=\"h_lable\">Golongan Darah</span>\n                        <q-select v-model=\"form.golongan_darah\" :options=\"[\n                        { label: 'A', value: 'A' },\n                        { label: 'B', value: 'B' },\n                        { label: 'AB', value: 'AB' },\n                        { label: 'O', value: 'O' }\n                     ]\" outlined required square emit-value map-options :dense=\"true\" class=\"bg-white margin_btn\" />\n                     </div>\n\n                     <div class=\"col-6\">\n                        <span class=\"h_lable\">Rhesus *Kosongkan jika tidak tau</span>\n                        <q-select v-model=\"form.rhesus\" :options=\"[\n                        { label: '+', value: '+' },\n                        { label: '-', value: '-' }\n                     ]\" outlined square emit-value map-options :dense=\"true\" class=\"bg-white margin_btn\" />\n\n                     </div>\n                  </div>\n\n\n\n                  <div class=\"row q-col-gutter-md margin_btn\">\n                     <div class=\"col-4\">\n                        <span class=\"h_lable\">Kabupaten (Optional)</span>\n                        <q-select v-model=\"form.kabupaten_id\" :options=\"kabupatenOptions\" outlined square dense\n                           emit-value map-options />\n\n                     </div>\n\n                     <div class=\"col-4\">\n                        <span class=\"h_lable\">Kecamatan (Optional)</span>\n                        <q-select v-model=\"form.kecamatan_id\" :options=\"kecamatanOptions\" outlined square dense\n                           emit-value map-options :disable=\"!form.kabupaten_id\" />\n\n                     </div>\n                     <div class=\"col-4\">\n                        <span class=\"h_lable\">Desa/Kelurahan (Optional)</span>\n                        <q-select v-model=\"form.des_kel_id\" :options=\"deskelOptions\" outlined square dense emit-value\n                           map-options :disable=\"!form.kecamatan_id\" />\n                     </div>\n                  </div>\n\n\n                  <span class=\"h_lable\">Alamat (Optional)</span>\n                  <q-input v-model=\"form.alamat\" type=\"textarea\" outlined square :dense=\"true\"\n                     class=\"bg-white margin_btn\" />\n\n\n                  <span class=\"h_lable\">Riwayat Penyakit (Optional)</span>\n                  <q-input v-model=\"form.riwayat_penyakit\" type=\"textarea\" outlined square :dense=\"true\"\n                     class=\"bg-white margin_btn\" />\n\n                  <span class=\"h_lable\">Terakhir Donor (Optional)</span>\n                  <q-input v-model=\"form.terakhir_donor\" type=\"date\" outlined square :dense=\"true\"\n                     class=\"bg-white margin_btn\" />\n\n\n\n                  <span class=\"h_lable\">Foto Profil (Optional)</span>\n                  <q-file v-model=\"form.foto_profil\" label=\"Pilih Foto\" accept=\"image/*\" outlined square dense\n                     class=\"bg-white margin_btn\" />\n\n                  <span class=\"h_lable\">Dokumen Pendukung (Optional)</span>\n                  <q-file v-model=\"form.dokumen_pendukung\" label=\"Pilih Dokumen\" accept=\".pdf,application/pdf\" outlined\n                     square dense class=\"bg-white margin_btn\" />\n\n                  <hr class=\"hrpagin2\">\n\n                  <span class=\"h_lable \">Username</span>\n                  <q-input v-model=\"dataku.username\" outlined square :dense=\"true\" class=\"bg-white margin_btn\" />\n\n\n                  <span class=\"h_lable \">Password</span>\n                  <q-input type=\"password\" v-model=\"dataku.password\" outlined square :dense=\"true\"\n                     class=\"bg-white margin_btn\" />\n\n                  <span class=\"h_lable \">Confirm Password</span>\n                  <q-input type=\"password\" v-model=\"dataku.confirmPassword\" outlined square :dense=\"true\"\n                     class=\"bg-white margin_btn\" />\n\n                  <hr class=\"hrpagin2\">\n\n               </q-card-section>\n\n               <q-card-actions class=\"bg-grey-4 mdl-footer\" align=\"right\">\n                  <q-btn :loading=\"btn_add\" color=\"primary\" type=\"submit\" label=\"Simpan\" />\n                  <q-btn label=\"Batal\" color=\"negative\" v-close-popup />\n               </q-card-actions>\n            </form>\n         </q-card>\n      </q-dialog>\n\n      <!-- ===================== MODAL EDIT ===================== -->\n      <q-dialog v-model=\"mdl_edit\" persistent>\n         <q-card class=\"mdl-md\">\n            <q-card-section class=\"bg-orange text-white\">\n               <div class=\"text-h6 h_modalhead\">Edit Pendonor</div>\n            </q-card-section>\n\n            <form @submit.prevent=\"updateData()\">\n\n               <q-card-section class=\"q-pt-none\">\n\n                  <hr class=\"hrpagin2\">\n\n                  <span class=\"h_lable\">Nama Lengkap</span>\n                  <q-input v-model=\"form.nama_lengkap\" outlined square :dense=\"true\" class=\"bg-white margin_btn\" />\n                  <span class=\"h_lable\">NIK</span>\n                  <q-input v-model=\"form.nik\" outlined square :dense=\"true\" class=\"bg-white margin_btn\" />\n\n                  <div class=\"row q-col-gutter-md\">\n                     <div class=\"col-6\">\n                        <span class=\"h_lable\">Tanggal Lahir</span>\n                        <q-input v-model=\"form.tanggal_lahir\" type=\"date\" outlined square :dense=\"true\"\n                           class=\"bg-white margin_btn\" />\n                     </div>\n\n                     <div class=\"col-6\">\n                        <span class=\"h_lable\">Jenis Kelamin</span>\n                        <q-select v-model=\"form.jenis_kelamin\" :options=\"[\n                        { label: 'Laki-laki', value: 'L' },\n                        { label: 'Perempuan', value: 'P' }\n                     ]\" outlined square :dense=\"true\" class=\"bg-white margin_btn\" />\n                     </div>\n                  </div>\n\n                  <div class=\"row q-col-gutter-md\">\n                     <div class=\"col-6\">\n                        <span class=\"h_lable\">Email</span>\n                        <q-input v-model=\"form.email\" type=\"email\" outlined square :dense=\"true\"\n                           class=\"bg-white margin_btn\" />\n                     </div>\n\n                     <div class=\"col-6\">\n                        <span class=\"h_lable\">No HP</span>\n                        <q-input v-model=\"form.no_hp\" type=\"tel\" outlined square :dense=\"true\"\n                           class=\"bg-white margin_btn\" />\n                     </div>\n                  </div>\n\n                  <div class=\"row q-col-gutter-md\">\n                     <div class=\"col-6\">\n                        <span class=\"h_lable\">Golongan Darah</span>\n                        <q-select v-model=\"form.golongan_darah\" :options=\"[\n                        { label: 'A', value: 'A' },\n                        { label: 'B', value: 'B' },\n                        { label: 'AB', value: 'AB' },\n                        { label: 'O', value: 'O' }\n                     ]\" outlined square :dense=\"true\" class=\"bg-white margin_btn\" />\n                     </div>\n\n                     <div class=\"col-6\">\n                        <span class=\"h_lable\">Rhesus *Kosongkan jika tidak tau</span>\n                        <q-select v-model=\"form.rhesus\" :options=\"[\n                        { label: '+', value: '+' },\n                        { label: '-', value: '-' }\n                     ]\" outlined square :dense=\"true\" class=\"bg-white margin_btn\" />\n                     </div>\n                  </div>\n\n                  <div class=\"row q-col-gutter-md\">\n                     <div class=\"col-4\">\n                        <span class=\"h_lable\">Kabupaten (Optional)</span>\n                        <q-select v-model=\"form.kabupaten_id\" :options=\"kabupatenOptions\" outlined square :dense=\"true\"\n                           class=\"bg-white margin_btn\" emit-value map-options />\n                     </div>\n\n                     <div class=\"col-4\">\n                        <span class=\"h_lable\">Kecamatan (Optional)</span>\n                        <q-select v-model=\"form.kecamatan_id\" :options=\"kecamatanOptions\" outlined square :dense=\"true\"\n                           class=\"bg-white margin_btn\" emit-value map-options />\n                     </div>\n\n                     <div class=\"col-4\">\n                        <span class=\"h_lable\">Desa/Kelurahan (Optional)</span>\n                        <q-select v-model=\"form.des_kel_id\" :options=\"deskelOptions\" outlined square :dense=\"true\"\n                           class=\"bg-white margin_btn\" emit-value map-options />\n                     </div>\n                  </div>\n\n                  <span class=\"h_lable\">Alamat (Optional)</span>\n                  <q-input v-model=\"form.alamat\" type=\"textarea\" outlined square :dense=\"true\"\n                     class=\"bg-white margin_btn\" />\n\n                  <span class=\"h_lable\">Riwayat Penyakit (Optional)</span>\n                  <q-input v-model=\"form.riwayat_penyakit\" type=\"textarea\" outlined square :dense=\"true\"\n                     class=\"bg-white margin_btn\" />\n\n                  <span class=\"h_lable\">Terakhir Donor (Optional)</span>\n                  <q-input v-model=\"form.terakhir_donor\" type=\"date\" outlined square :dense=\"true\"\n                     class=\"bg-white margin_btn\" />\n\n                  <span class=\"h_lable\">Foto Profil (Optional)</span>\n                  <q-file v-model=\"form.foto_profil\" label=\"Pilih Foto\" accept=\"image/*\" outlined square dense\n                     class=\"bg-white margin_btn\" :clearable=\"true\" />\n                  <div v-if=\"form.foto_profil_url\" class=\"q-mb-md\">\n                     <img :src=\"form.foto_profil_url\" alt=\"Foto Profil\" style=\"max-width: 150px; max-height: 150px;\" />\n                  </div>\n\n                  <span class=\"h_lable\">Dokumen Pendukung (Optional)</span>\n                  <q-file v-model=\"form.dokumen_pendukung\" label=\"Pilih Dokumen\" accept=\".pdf,application/pdf\" outlined\n                     square dense class=\"bg-white margin_btn\" :clearable=\"true\" />\n                  <div v-if=\"form.dokumen_pendukung_url\" class=\"q-mb-md\">\n                     <a :href=\"form.dokumen_pendukung_url\" target=\"_blank\" rel=\"noopener\">Lihat Dokumen Saat Ini</a>\n                  </div>\n                  <hr class=\"hrpagin2\">\n\n                  <span class=\"h_lable\">Username</span>\n                  <q-input v-model=\"dataku.username\" outlined square :dense=\"true\" class=\"bg-white margin_btn\"\n                     placeholder=\"Masukkan username baru jika ingin ubah\" />\n\n\n                  <hr class=\"hrpagin2\">\n\n               </q-card-section>\n\n               <q-card-actions class=\"bg-grey-4 mdl-footer\" align=\"right\">\n                  <q-btn :loading=\"btn_edit\" color=\"warning\" type=\"submit\" label=\"Update\" />\n                  <q-btn label=\"Batal\" color=\"negative\" v-close-popup />\n               </q-card-actions>\n            </form>\n         </q-card>\n      </q-dialog>\n\n\n      <!-- ================================================= MODAL PASSWORD ================================================ -->\n      <!-- ===================== MODAL EDIT PASSWORD ===================== -->\n      <q-dialog v-model=\"mdl_password\" persistent>\n         <q-card class=\"mdl-md\">\n            <q-card-section class=\"bg-blue text-white\">\n               <div class=\"text-h6 h_modalhead\">Ubah Password Pendonor</div>\n            </q-card-section>\n\n            <form @submit.prevent=\"editDataPassword()\">\n\n               <q-card-section class=\"q-pt-none\">\n\n                  <hr class=\"hrpagin2\">\n\n                  <span class=\"h_lable\">Password Baru</span>\n                  <q-input v-model=\"dataku.password\" :type=\"isPwd ? 'password' : 'text'\" outlined square :dense=\"true\"\n                     class=\"bg-white margin_btn\" placeholder=\"Minimal 6 karakter\" :loading=\"btn_password\" />\n                  <q-toggle v-model=\"isPwd\" icon=\"visibility\" class=\"q-pt-none\" />\n                  <hr>\n                  <span class=\"h_lable\">Konfirmasi Password</span>\n                  <q-input v-model=\"dataku.confirmPassword\" :type=\"isPwd2 ? 'password' : 'text'\" outlined square\n                     :dense=\"true\" class=\"bg-white margin_btn\" placeholder=\"Ulangi password baru\" />\n                  <q-toggle v-model=\"isPwd2\" icon=\"visibility\" class=\"q-pt-none\" />\n\n                  <hr class=\"hrpagin2\">\n\n               </q-card-section>\n\n               <q-card-actions class=\"bg-grey-4 mdl-footer\" align=\"right\">\n                  <q-btn :loading=\"btn_password\" color=\"primary\" type=\"submit\" label=\"Ubah Password\" />\n                  <q-btn label=\"Batal\" color=\"negative\" v-close-popup @click=\"resetPasswordForm\" />\n               </q-card-actions>\n            </form>\n         </q-card>\n      </q-dialog>\n      <!-- ================================================= MODAL PASSWORD ================================================ -->\n      <!-- ================================================ MODAL HAPUS ================================================ -->\n      <q-dialog v-model=\"mdl_hapus\" persistent>\n         <q-card class=\"mdl-sm\">\n            <q-card-section class=\"q-pt-none text-center orageGrad\">\n               <form @submit.prevent=\"hapusData\">\n                  <br>\n                  <img src=\"img/alert.png\" alt=\"\" width=\"75\"> <br>\n                  <span class=\"h_notifikasi\">APAKAH ANDA YAKIN INGIN MENGHAPUS DATA INI??</span>\n                  <br>\n                  <br>\n\n                  <q-card-actions align=\"center\">\n                     <q-btn label=\"Batal\" size=\"sm\" color=\"negative\" v-close-popup @click=\"resetHapusForm\" />\n                     &nbsp;\n                     <q-btn :loading=\"btn_hapus\" type=\"submit\" label=\"Hapus\" size=\"sm\" color=\"primary\" v-close-popup />\n                  </q-card-actions>\n               </form>\n            </q-card-section>\n         </q-card>\n      </q-dialog>\n\n      <!-- ================================================ MODAL HAPUS ================================================ -->\n\n      <q-dialog v-model=\"mdl_lihat\" persistent>\n         <q-card class=\"mdl-md detail-modal\" style=\"box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12); border-radius: 12px;\">\n            <q-card-section class=\"bg-green text-white q-pa-lg\" style=\"border-radius: 12px 12px 0 0;\">\n               <div class=\"text-h6 h_modalhead flex items-center q-gutter-sm\">\n                  <q-icon name=\"bloodtype\" size=\"24px\" />\n                  <span>Detail Pendonor</span>\n               </div>\n            </q-card-section>\n            <div class=\"col-12 text-center q-mb-xs\">\n               <div v-if=\"lihatData.foto_profil\" class=\"q-pa-md\">\n                  <img :src=\"file_path + lihatData.foto_profil\" alt=\"Foto Profil Pendonor\"\n                     style=\"max-width: 200px; max-height: 200px; object-fit: cover; border-radius: 12px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);\"\n                     @error=\"handleImageError\" />\n                  <div class=\"text-caption text-grey-6 q-mt-sm\">Foto Profil</div>\n               </div>\n               <div v-else class=\"q-pa-md bg-grey-1 rounded\"\n                  style=\"width: 200px; height: 200px; display: inline-flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 12px; border: 2px dashed grey-4;\">\n                  <q-icon name=\"account_circle_off\" size=\"64px\" color=\"grey-5\" />\n                  <div class=\"text-h6 text-grey-6 q-mt-sm\">Tidak Ada Foto Profil</div>\n                  <div class=\"text-caption text-grey-7 q-mt-xs\">Foto belum diunggah</div>\n               </div>\n            </div>\n\n            <q-card-section class=\"q-pa-md\">\n\n               <div class=\"row q-col-gutter-lg\">\n                  <div class=\"col-12 col-md-6\">\n                     <div class=\"text-h6 text-grey-8 q-mb-md q-pa-sm bg-grey-2 rounded\"\n                        style=\"border-left: 4px solid #4caf50;\">\n                        Data Pribadi & Darah\n                     </div>\n\n                     <div class=\"q-gutter-y-md\">\n                        <div class=\"row items-start q-gutter-sm detail-field\">\n                           <q-icon name=\"person\" size=\"16px\" color=\"grey-6\" class=\"q-mt-xs\" />\n                           <div class=\"col\">\n                              <div class=\"text-caption text-grey-7 text-weight-medium q-mb-xs\">Nama Lengkap</div>\n                              <div class=\"text-body1 text-weight-bold text-grey-9\">{{ lihatData.nama_lengkap || '-' }}\n                              </div>\n                           </div>\n                        </div>\n\n                        <div class=\"row items-start q-gutter-sm detail-field\">\n                           <q-icon name=\"event\" size=\"16px\" color=\"grey-6\" class=\"q-mt-xs\" />\n                           <div class=\"col\">\n                              <div class=\"text-caption text-grey-7 text-weight-medium q-mb-xs\">Tanggal Lahir</div>\n                              <div class=\"text-body1 text-weight-bold text-grey-9\">{{\n                        UMUM.tglConvert(lihatData.tanggal_lahir) || '-' }}</div>\n                           </div>\n                        </div>\n\n                        <div class=\"row items-start q-gutter-sm detail-field\">\n                           <q-icon name=\"wc\" size=\"16px\" color=\"grey-6\" class=\"q-mt-xs\" />\n                           <div class=\"col\">\n                              <div class=\"text-caption text-grey-7 text-weight-medium q-mb-xs\">Jenis Kelamin</div>\n                              <div class=\"text-body1 text-weight-bold text-grey-9\">{{ lihatData.jenis_kelamin === 'L' ?\n                        'Laki-laki' : lihatData.jenis_kelamin === 'P' ? 'Perempuan' : '-' }}</div>\n                           </div>\n                        </div>\n\n                        <div class=\"row items-start q-gutter-sm detail-field\">\n                           <q-icon name=\"bloodtype\" size=\"16px\" color=\"grey-6\" class=\"q-mt-xs\" />\n                           <div class=\"col\">\n                              <div class=\"text-caption text-grey-7 text-weight-medium q-mb-xs\">Golongan Darah</div>\n                              <div class=\"text-body1 text-weight-bold text-grey-9\">{{ lihatData.golongan_darah || '-' }}\n                              </div>\n                           </div>\n                        </div>\n\n                        <div class=\"row items-start q-gutter-sm detail-field\">\n                           <q-icon name=\"science\" size=\"16px\" color=\"grey-6\" class=\"q-mt-xs\" />\n                           <div class=\"col\">\n                              <div class=\"text-caption text-grey-7 text-weight-medium q-mb-xs\">Rhesus</div>\n                              <div class=\"text-body1 text-weight-bold text-grey-9\">{{ lihatData.rhesus || '-' }}</div>\n                           </div>\n                        </div>\n\n                        <div class=\"row items-start q-gutter-sm detail-field\">\n                           <q-icon name=\"calendar_today\" size=\"16px\" color=\"grey-6\" class=\"q-mt-xs\" />\n                           <div class=\"col\">\n                              <div class=\"text-caption text-grey-7 text-weight-medium q-mb-xs\">Terakhir Donor</div>\n                              <div class=\"text-body1 text-weight-bold text-grey-9\">{{\n                        UMUM.tglConvert(lihatData.terakhir_donor) || '-' }}</div>\n                           </div>\n                        </div>\n                     </div>\n                  </div>\n\n                  <div class=\"col-12 col-md-6\">\n                     <div class=\"text-h6 text-grey-8 q-mb-md q-pa-sm bg-grey-2 rounded\"\n                        style=\"border-left: 4px solid #4caf50;\">\n                        Data Kontak & Lokasi\n                     </div>\n                     <div class=\"q-gutter-y-md\">\n                        <div class=\"row items-start q-gutter-sm detail-field\">\n                           <q-icon name=\"email\" size=\"16px\" color=\"grey-6\" class=\"q-mt-xs\" />\n                           <div class=\"col\">\n                              <div class=\"text-caption text-grey-7 text-weight-medium q-mb-xs\">Email</div>\n                              <div class=\"text-body1 text-weight-bold text-grey-9\">{{ lihatData.email || '-' }}</div>\n                           </div>\n                        </div>\n\n                        <div class=\"row items-start q-gutter-sm detail-field\">\n                           <q-icon name=\"phone\" size=\"16px\" color=\"grey-6\" class=\"q-mt-xs\" />\n                           <div class=\"col\">\n                              <div class=\"text-caption text-grey-7 text-weight-medium q-mb-xs\">No HP</div>\n                              <div class=\"text-body1 text-weight-bold text-grey-9\">{{ lihatData.no_hp || '-' }}</div>\n                           </div>\n                        </div>\n                        <div class=\"row items-start q-gutter-sm detail-field\">\n                           <q-icon name=\"location_on\" size=\"16px\" color=\"grey-6\" class=\"q-mt-xs\" />\n                           <div class=\"col\">\n                              <div class=\"text-caption text-grey-7 text-weight-medium q-mb-xs\">Alamat Lengkap</div>\n                              <div class=\"text-body1 text-weight-bold text-grey-9\">{{ lihatData.alamat || '-' }}</div>\n                           </div>\n                        </div>\n\n                        <div class=\"row items-start q-gutter-sm detail-field\">\n                           <q-icon name=\"map\" size=\"16px\" color=\"grey-6\" class=\"q-mt-xs\" />\n                           <div class=\"col\">\n                              <div class=\"text-caption text-grey-7 text-weight-medium q-mb-xs\">Lokasi</div>\n                              <div class=\"text-body1 text-weight-bold text-grey-9\">\n                                 {{ [lihatData.kabupaten_nama, lihatData.kecamatan_nama,\n                     lihatData.des_kel_nama].filter(Boolean).join(', ') || '-' }}\n                              </div>\n                           </div>\n                        </div>\n\n                        <div class=\"row items-start q-gutter-sm detail-field\">\n                           <q-icon name=\"local_hospital\" size=\"16px\" color=\"grey-6\" class=\"q-mt-xs\" />\n                           <div class=\"col\">\n                              <div class=\"text-caption text-grey-7 text-weight-medium q-mb-xs\">Riwayat Penyakit</div>\n                              <div class=\"text-body1 text-weight-bold text-grey-9\">{{ lihatData.riwayat_penyakit || '-'\n                                 }}</div>\n                           </div>\n                        </div>\n\n                        <div class=\"row items-start q-gutter-sm detail-field\">\n                           <q-icon name=\"account_circle\" size=\"16px\" color=\"grey-6\" class=\"q-mt-xs\" />\n                           <div class=\"col\">\n                              <div class=\"text-caption text-grey-7 text-weight-medium q-mb-xs\">Username</div>\n                              <div class=\"text-body1 text-weight-bold text-grey-9\">{{ lihatData.username || '-' }}</div>\n                           </div>\n                        </div>\n                     </div>\n                  </div>\n\n                  <div class=\"col-12 q-mt-xl\">\n                     <q-separator class=\"q-mb-md\" />\n                     <q-banner v-if=\"lihatData.dokumen_pendukung\" dense rounded class=\"bg-green-1 text-primary\"\n                        style=\"border-left: 4px solid #4caf50; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);\">\n                        <template v-slot:avatar>\n                           <q-icon name=\"picture_as_pdf\" size=\"20px\" color=\"positive\" />\n                        </template>\n                        <div>\n                           <span class=\"text-weight-bold text-body2\">Dokumen Pendukung Tersedia</span>\n                           <div class=\"text-caption q-mt-xs\">Klik tombol di samping untuk membuka dokumen PDF di tab\n                              baru.</div>\n                        </div>\n                        <template v-slot:action>\n                           <q-btn color=\"primary\" label=\"Lihat Dokumen\" @click=\"openDokumen()\" flat dense unelevated\n                              size=\"sm\" />\n                        </template>\n                     </q-banner>\n                     <div v-else class=\"text-center q-pa-lg bg-grey-1 rounded\" style=\"border-left: 4px solid #9e9e9e;\">\n                        <q-icon name=\"picture_as_pdf_off\" size=\"32px\" color=\"grey-5\" />\n                        <div class=\"text-h6 text-grey-6 q-mt-sm\">Tidak Ada Dokumen Pendukung</div>\n                        <div class=\"text-caption text-grey-7\">Dokumen belum diunggah.</div>\n                     </div>\n                  </div>\n               </div>\n            </q-card-section>\n\n            <q-card-actions align=\"right\" class=\"bg-grey-2 text-grey-8 q-pa-lg\" style=\"border-radius: 0 0 12px 12px;\">\n               <q-btn label=\"Tutup\" color=\"negative\" v-close-popup unelevated size=\"md\" />\n            </q-card-actions>\n         </q-card>\n      </q-dialog>\n\n\n      <!-- MODAL RIWAYAT DONOR -->\n<q-dialog v-model=\"mdl_riwayat\">\n  <q-card class=\"mdl-md\">\n    <q-card-section class=\"main2 text-white\">\n      <div class=\"text-h6 h_modalhead\">Riwayat Donor - {{ currentPendonor.nama_lengkap || '-' }}</div>\n    </q-card-section>\n\n    <q-card-section class=\"q-pa-lg scroll\" style=\"max-height: 70vh; overflow-y: auto;\">\n      <div v-if=\"riwayatLoading\" class=\"row items-center justify-center q-pa-md\">\n        <q-spinner-dots size=\"30px\" />\n      </div>\n\n      <div v-else class=\"tbl_responsive q-mb-md\">\n        <table width=\"100%\">\n          <tr class=\"h_table_head main1 text-white \">\n            <th class=\"text-center\" width=\"5%\">No</th>\n            <th>Nama Kegiatan</th>\n            <th width=\"18%\">Tanggal Mulai</th>\n            <th width=\"18%\">Tanggal Selesai</th>\n            <th>Lokasi</th>\n          </tr>\n\n          <tr v-for=\"(r, i) in riwayatList\" :key=\"r.jadwal_id || i\" class=\"h_table_body\">\n            <td class=\"text-center\">{{ i + 1 }}</td>\n            <td>{{ r.nama_kegiatan || '-' }}</td>\n            <td>{{ UMUM.tglConvert ? UMUM.tglConvert(r.tanggal_mulai) : r.tanggal_mulai || '-' }}</td>\n            <td>{{ UMUM.tglConvert ? UMUM.tglConvert(r.tanggal_selesai) : r.tanggal_selesai || '-' }}</td>\n            <td>{{ r.lokasi || '-' }}</td>\n          </tr>\n\n          <tr v-if=\"!riwayatList.length && !riwayatLoading\">\n            <td colspan=\"5\" class=\"text-center text-grey\">Belum ada riwayat donor</td>\n          </tr>\n        </table>\n      </div>\n    </q-card-section>\n\n    <q-separator />\n    <q-card-actions class=\"bg-grey-4 mdl-footer\" align=\"right\">\n      <q-btn label=\"Tutup\" color=\"negative\" v-close-popup @click=\"mdl_riwayat = false\" />\n    </q-card-actions>\n  </q-card>\n</q-dialog>\n\n   </div>\n</template>\n\n\n<script>\nimport UMUM from \"../../library/umum.js\";\nexport default {\n   data() {\n      return {\n         UMUM: UMUM,\n         isPwd: true,\n         isPwd2: true,\n         btn_password: false,\n\n         form: {\n            id: null,\n            users_id: null,\n            nama_lengkap: '',\n            nik: '',\n            tanggal_lahir: '',\n            jenis_kelamin: '',\n            golongan_darah: '',\n            rhesus: '',\n            kabupaten_id: null,\n            kecamatan_id: null,\n            des_kel_id: null,\n            alamat: '',\n            email: '',\n            no_hp: '',\n            riwayat_penyakit: null,\n            terakhir_donor: null,\n            foto_profil: null,\n            dokumen_pendukung: null,\n            foto_profil_url: '',\n            dokumen_pendukung_url: '',\n            stokdarah_konut: 4,\n            bersedia_dipublikasikan: true,\n         },\n         kabupatenOptions: [],\n         kecamatanOptions: [],\n         deskelOptions: [],\n\n         mdl_add: false,\n         mdl_edit: false,\n         mdl_hapus: false,\n         btn_add: false,\n         btn_edit: false,\n         btn_hapus: false,\n\n         list_data: [],\n         jml_data: 0,\n         total_data: 0,\n         page_first: 1,\n         page_last: 0,\n         page_limit: 10,\n         cari_value: '',\n\n         mdl_riwayat: false,\ncurrentPendonor: {},\nriwayatList: [],\nriwayatLoading: false,\n\n\n\n         mdl_password: false,\n         dataku: {\n            username: '',\n            password: '',\n            confirmPassword: ''\n         },\n         errorMessage: '',\n         mdl_lihat: false,\n         lihatData: {\n            nama_lengkap: '',\n            tanggal_lahir: '',\n            jenis_kelamin: '',\n            golongan_darah: '',\n            rhesus: '',\n            email: '',\n            no_hp: '',\n            alamat: '',\n            riwayat_penyakit: '',\n            terakhir_donor: '',\n            kabupaten_nama: '',\n            kecamatan_nama: '',\n            des_kel_nama: '',\n            foto_profil: '',\n            dokumen_pendukung: '',\n            username: '',\n            users_id: '',\n            id: '',\n         },\n      }\n   },\n   computed: {\n      file_path() {\n         return this.$store.state.url.URL_APP + \"uploads/\";\n      }\n   },\n   watch: {\n      'form.kabupaten_id'(newVal) {\n         this.form.kecamatan_id = null;\n         this.form.des_kel_id = null;\n         this.kecamatanOptions = [];\n         this.deskelOptions = [];\n         if (newVal) {\n            this.loadKecamatan(newVal);\n         }\n      },\n      'form.kecamatan_id'(newVal) {\n         this.form.des_kel_id = null;\n         this.deskelOptions = [];\n         if (newVal) {\n            this.loadDeskel(newVal);\n         }\n      }\n   },\n   methods: {\n      loadKabupaten() {\n         fetch(this.$store.state.url.REGIS_DONOR + \"kabupaten\")\n            .then(res => res.json())\n            .then(res => {\n               if (res.success) {\n                  this.kabupatenOptions = res.data.map(item => ({\n                     label: item.label,\n                     value: item.id\n                  }));\n               } else {\n                  this.$q.notify({ type: 'negative', message: 'Gagal memuat data kabupaten' });\n               }\n            })\n            .catch(() => {\n               this.$q.notify({ type: 'negative', message: 'Terjadi kesalahan saat memuat kabupaten' });\n            });\n      },\n      loadKecamatan(kabupatenId) {\n         fetch(`${this.$store.state.url.REGIS_DONOR}kecamatan?kabupaten_id=${kabupatenId}`)\n            .then(res => res.json())\n            .then(res => {\n               if (res.success) {\n                  this.kecamatanOptions = res.data.map(item => ({\n                     label: item.label,\n                     value: item.id\n                  }));\n               } else {\n                  this.$q.notify({ type: 'negative', message: 'Gagal memuat data kecamatan' });\n               }\n            })\n            .catch(() => {\n               this.$q.notify({ type: 'negative', message: 'Terjadi kesalahan saat memuat kecamatan' });\n            });\n      },\n      loadDeskel(kecamatanId) {\n         fetch(`${this.$store.state.url.REGIS_DONOR}deskel?kecamatan_id=${kecamatanId}`)\n            .then(res => res.json())\n            .then(res => {\n               if (res.success) {\n                  this.deskelOptions = res.data.map(item => ({\n                     label: item.label,\n                     value: item.id\n                  }));\n               } else {\n                  this.$q.notify({ type: 'negative', message: 'Gagal memuat data desa/kelurahan' });\n               }\n            })\n            .catch(() => {\n               this.$q.notify({ type: 'negative', message: 'Terjadi kesalahan saat memuat desa/kelurahan' });\n            });\n      },\n\n\n      getView() {\n         const body = {\n            page_limit: this.page_limit,\n            data_ke: (this.page_first - 1) * this.page_limit,\n            cari_value: this.cari_value,\n         };\n\n         fetch(this.$store.state.url.REGIS_DONOR + \"getview\", {\n            method: \"POST\",\n            headers: {\n               \"content-type\": \"application/json\",\n               authorization: \"kikensbatara \" + localStorage.token\n            },\n            body: JSON.stringify(body)\n         })\n            .then(res => res.json())\n            .then(res_data => {\n               if (res_data.success) {\n                  this.list_data = res_data.data;\n                  this.jml_data = res_data.jml_data;\n                  this.total_data = res_data.total_data;\n                  this.page_last = Math.ceil(this.total_data / this.page_limit);\n               } else {\n                  this.$q.notify({ type: \"negative\", message: res_data.message || \"Gagal mengambil data\" });\n               }\n            })\n            .catch(err => {\n               console.error(\"Error fetching data:\", err);\n               this.$q.notify({ type: \"negative\", message: \"Gagal mengambil data pendonor\" });\n            });\n      },\n\n      async addData() {\n         try {\n\n            if (this.dataku.password !== this.dataku.confirmPassword) {\n               this.$q.notify({\n                  type: 'negative',\n                  message: 'Password dan konfirmasi password tidak sama!'\n               });\n               return;\n            }\n            if (this.dataku.password.length < 6) {\n               this.$q.notify({\n                  type: 'negative',\n                  message: 'Password minimal 6 karakter!'\n               });\n               return;\n            }\n            if (!this.dataku.username) {\n               this.$q.notify({\n                  type: 'negative',\n                  message: 'Username wajib diisi!'\n               });\n               return;\n            }\n\n            this.btn_add = true;\n\n            const formData = new FormData();\n            formData.append('nama_lengkap', this.form.nama_lengkap);\n            formData.append('nik', this.form.nik);\n            formData.append('tanggal_lahir', this.form.tanggal_lahir);\n            formData.append('jenis_kelamin', this.form.jenis_kelamin);\n            formData.append('golongan_darah', this.form.golongan_darah);\n            formData.append('rhesus', this.form.rhesus || '');\n            formData.append('kabupaten_id', this.form.kabupaten_id || '');\n            formData.append('kecamatan_id', this.form.kecamatan_id || '');\n            formData.append('des_kel_id', this.form.des_kel_id || '');\n            formData.append('alamat', this.form.alamat || '');\n            formData.append('email', this.form.email || '');\n            formData.append('no_hp', this.form.no_hp || '');\n            formData.append('riwayat_penyakit', this.form.riwayat_penyakit || '');\n            formData.append('terakhir_donor', this.form.terakhir_donor || '');\n            formData.append('stokdarah_konut', this.form.stokdarah_konut || 4);\n            formData.append('bersedia_dipublikasikan', 1);\n\n\n            formData.append('username', this.dataku.username);\n            formData.append('password', this.dataku.password);\n\n            // Append file\n            if (this.form.foto_profil && this.form.foto_profil instanceof File) {\n               formData.append('foto_profil', this.form.foto_profil);\n            }\n            if (this.form.dokumen_pendukung && this.form.dokumen_pendukung instanceof File) {\n               formData.append('dokumen_pendukung', this.form.dokumen_pendukung);\n            }\n\n            const response = await fetch(this.$store.state.url.REGIS_DONOR + \"addData\", {\n               method: 'POST',\n               headers: {\n                  authorization: \"kikensbatara \" + localStorage.token\n               },\n               body: formData\n            });\n\n            const result = await response.json();\n\n            if (response.ok && result.success) {\n               this.$q.notify({\n                  type: 'positive',\n                  message: result.message || 'Data pendonor berhasil ditambahkan!'\n               });\n\n               this.resetForm();\n               this.mdl_add = false;\n               this.getView();\n            } else {\n               throw new Error(result.message || 'Terjadi kesalahan saat menambah data');\n            }\n         } catch (error) {\n            console.error('Error adding data:', error);\n            this.$q.notify({\n               type: 'negative',\n               message: error.message || 'Gagal menambah data pendonor!'\n            });\n         } finally {\n            this.btn_add = false;\n         }\n      },\n\n      editModal(data) {\n         this.form = {\n            id: data.id,\n            users_id: data.users_id || null,\n            nama_lengkap: data.nama_lengkap || '',\n            nik: data.nik || '',\n            tanggal_lahir: data.tanggal_lahir || '',\n            jenis_kelamin: data.jenis_kelamin || '',\n            email: data.email || '',\n            no_hp: data.no_hp || '',\n            golongan_darah: data.golongan_darah || '',\n            rhesus: data.rhesus || '',\n            kabupaten_id: data.kabupaten_id || null,\n            kecamatan_id: data.kecamatan_id || null,\n            des_kel_id: data.des_kel_id || null,\n            alamat: data.alamat || '',\n            riwayat_penyakit: data.riwayat_penyakit || null,\n            terakhir_donor: data.terakhir_donor || null,\n            foto_profil: null,\n            dokumen_pendukung: null,\n            foto_profil_url: data.foto_profil ? (this.file_path + data.foto_profil) : '',\n            dokumen_pendukung_url: data.dokumen_pendukung ? (this.file_path + data.dokumen_pendukung) : '',\n            stokdarah_konut: data.stokdarah_konut || 4,\n            bersedia_dipublikasikan: data.bersedia_dipublikasikan || true,\n         };\n\n\n         this.dataku.username = data.username || '';\n\n         if (this.form.kabupaten_id) {\n            this.loadKecamatan(this.form.kabupaten_id);\n            if (this.form.kecamatan_id) {\n               this.loadDeskel(this.form.kecamatan_id);\n            }\n         }\n\n         this.dataku.password = '';\n         this.dataku.confirmPassword = '';\n\n         this.mdl_edit = true;\n      },\n\n      async updateData() {\n         this.btn_edit = true;\n         try {\n            if (!this.form.nama_lengkap || !this.form.tanggal_lahir || !this.form.jenis_kelamin || !this.form.golongan_darah) {\n               throw new Error('Field wajib (Nama, TTL, Jenis Kelamin, Golongan Darah) harus diisi!');\n            }\n            if (this.dataku.username && this.dataku.username.length < 6) {\n               throw new Error('Username minimal 6 karakter jika diubah!');\n            }\n            if (this.form.nik && this.form.nik.length < 16) {\n               throw new Error('NIK harus berjumlah 16 angka!');\n            }\n            const normalizedTerakhirDonor = this.normalizeDate(this.form.terakhir_donor);\n            const normalizedTanggalLahir = this.normalizeDate(this.form.tanggal_lahir);\n            const payload = {\n               id: this.form.id,\n               users_id: this.form.users_id,\n               nama_lengkap: this.form.nama_lengkap,\n               nik: this.form.nik,\n               tanggal_lahir: normalizedTanggalLahir,\n               jenis_kelamin: this.form.jenis_kelamin,\n               email: this.form.email || '',\n               no_hp: this.form.no_hp || '',\n               golongan_darah: this.form.golongan_darah,\n               rhesus: this.form.rhesus || '',\n               kabupaten_id: this.form.kabupaten_id || null,\n               kecamatan_id: this.form.kecamatan_id || null,\n               des_kel_id: this.form.des_kel_id || null,\n               alamat: this.form.alamat || '',\n               riwayat_penyakit: this.form.riwayat_penyakit || '',\n               terakhir_donor: normalizedTerakhirDonor,\n               stokdarah_konut: this.form.stokdarah_konut || 4,\n               bersedia_dipublikasikan: this.form.bersedia_dipublikasikan ? 1 : 0,\n               username: this.dataku.username || '',\n            };\n\n            const hasNewFile = (this.form.foto_profil && this.form.foto_profil instanceof File) ||\n               (this.form.dokumen_pendukung && this.form.dokumen_pendukung instanceof File);\n\n            let response, result;\n\n            if (hasNewFile) {\n               const formData = new FormData();\n               for (const key in payload) {\n                  formData.append(key, payload[key] || '');\n               }\n               // Append files jika ada\n               if (this.form.foto_profil && this.form.foto_profil instanceof File) {\n                  formData.append('foto_profil', this.form.foto_profil);\n               }\n               if (this.form.dokumen_pendukung && this.form.dokumen_pendukung instanceof File) {\n                  formData.append('dokumen_pendukung', this.form.dokumen_pendukung);\n               }\n\n               response = await fetch(this.$store.state.url.REGIS_DONOR + \"editData\", {\n                  method: \"POST\",\n                  headers: {\n                     authorization: \"kikensbatara \" + localStorage.token\n                  },\n                  body: formData\n               });\n               result = await response.json();\n            } else {\n               response = await fetch(this.$store.state.url.REGIS_DONOR + \"editData\", {\n                  method: \"POST\",\n                  headers: {\n                     \"Content-Type\": \"application/json\",\n                     authorization: \"kikensbatara \" + localStorage.token\n                  },\n                  body: JSON.stringify(payload)\n               });\n               result = await response.json();\n            }\n\n            if (response.ok && result.success) {\n               this.$q.notify({\n                  type: \"positive\",\n                  message: result.message || \"Data pendonor berhasil diupdate\"\n               });\n\n               this.mdl_edit = false;\n               this.getView();\n               this.resetForm();\n            } else {\n               throw new Error(result.message || \"Gagal mengupdate data pendonor\");\n            }\n         } catch (error) {\n            console.error(\"Error update data pendonor:\", error);\n            this.$q.notify({\n               type: \"negative\",\n               message: error.message || \"Terjadi kesalahan saat update data pendonor\"\n            });\n         } finally {\n            this.btn_edit = false;\n         }\n      },\n\n      resetForm() {\n         this.form = {\n            id: null,\n            users_id: null,\n            nama_lengkap: '',\n            nik: '',\n            tanggal_lahir: '',\n            jenis_kelamin: '',\n            golongan_darah: '',\n            rhesus: '',\n            kabupaten_id: null,\n            kecamatan_id: null,\n            des_kel_id: null,\n            alamat: '',\n            email: '',\n            no_hp: '',\n            riwayat_penyakit: '',\n            terakhir_donor: '',\n            foto_profil: null,\n            dokumen_pendukung: null,\n            foto_profil_url: '',\n            dokumen_pendukung_url: '',\n            stokdarah_konut: 4,\n            bersedia_dipublikasikan: true,\n         };\n         this.dataku = {\n            username: '',\n            password: '',\n            confirmPassword: ''\n         };\n         this.kecamatanOptions = [];\n         this.deskelOptions = [];\n         this.errorMessage = '';\n      },\n\n      async hapusData() {\n         // Validasi ID wajib\n         if (!this.form.id || !this.form.users_id) {\n            this.$q.notify({\n               type: 'negative',\n               message: 'Data tidak valid. Silakan pilih ulang.'\n            });\n            this.resetHapusForm();\n            return;\n         }\n\n         this.btn_hapus = true;\n         try {\n            const payload = {\n               id: this.form.id,\n               users_id: this.form.users_id\n            };\n\n            const response = await fetch(this.$store.state.url.REGIS_DONOR + \"removePendonor\", {\n               method: \"POST\",\n               headers: {\n                  \"Content-Type\": \"application/json\",\n                  authorization: \"kikensbatara \" + localStorage.token\n               },\n               body: JSON.stringify(payload)\n            });\n\n            const res_data = await response.json();\n\n            if (response.ok && res_data.success) {\n               this.$q.notify({\n                  type: 'positive',\n                  message: res_data.message || 'Data pendonor berhasil dihapus'\n               });\n               this.mdl_hapus = false;\n               this.getView();\n               this.resetForm();\n            } else {\n               throw new Error(res_data.message || 'Gagal menghapus data');\n            }\n         } catch (error) {\n            console.error('Error hapus data:', error);\n            this.$q.notify({\n               type: 'negative',\n               message: error.message || 'Terjadi kesalahan saat menghapus data'\n            });\n         } finally {\n            this.btn_hapus = false;\n         }\n      },\n\n\n      async editDataPassword() {\n         this.errorMessage = '';\n\n         if (!this.dataku.password || !this.dataku.confirmPassword) {\n            this.errorMessage = \"Password dan Confirm Password wajib diisi!\";\n            return;\n         }\n\n         if (this.dataku.password.length < 6) {\n            this.errorMessage = \"Password minimal 6 karakter!\";\n            return;\n         }\n\n         if (this.dataku.password !== this.dataku.confirmPassword) {\n            this.errorMessage = \"Password dan Confirm Password tidak sama!\";\n            return;\n         }\n\n         try {\n            const res = await fetch(this.$store.state.url.REGIS_DONOR + \"editPasswordPendonor\", {\n               method: \"POST\",\n               headers: {\n                  \"Content-Type\": \"application/json\",\n                  authorization: \"kikensbatara \" + localStorage.token\n               },\n               body: JSON.stringify({\n                  users_id: this.dataku.users_id,\n                  password: this.dataku.password\n               })\n            });\n\n            const data = await res.json();\n\n            if (res.ok && data.success) {\n               this.$q.notify({ type: \"positive\", message: data.message || \"Password berhasil diubah!\" });\n               this.mdl_password = false;\n               this.dataku.password = '';\n               this.dataku.confirmPassword = '';\n            } else {\n               this.errorMessage = data.message || \"Gagal mengubah password!\";\n            }\n         } catch (error) {\n            console.error(error);\n            this.errorMessage = \"Terjadi kesalahan saat mengubah password.\";\n         }\n      },\n      selectData(data) {\n         this.dataku = {\n            users_id: data.users_id,\n            password: '',\n            confirmPassword: ''\n         };\n         this.errorMessage = '';\n         this.form = {\n            ...data,\n            users_id: data.users_id,\n            id: data.id\n         };\n         this.lihatData = {\n            nama_lengkap: data.nama_lengkap || '',\n            nik: data.nik || '',\n            tanggal_lahir: data.tanggal_lahir || '',\n            jenis_kelamin: data.jenis_kelamin || '',\n            golongan_darah: data.golongan_darah || '',\n            rhesus: data.rhesus || '',\n            email: data.email || '',\n            no_hp: data.no_hp || '',\n            alamat: data.alamat || '',\n            riwayat_penyakit: data.riwayat_penyakit || '',\n            terakhir_donor: data.terakhir_donor || '',\n            kabupaten_nama: data.kabupaten_nama || '',  // Asumsi dari backend; jika ID saja, fetch di sini\n            kecamatan_nama: data.kecamatan_nama || '',\n            des_kel_nama: data.des_kel_nama || '',\n            foto_profil: data.foto_profil || '',\n            dokumen_pendukung: data.dokumen_pendukung || '',\n            username: data.username || '',\n            users_id: data.users_id || '',\n            id: data.id || '',\n         };\n      },\n\n      resetPasswordForm() {\n         this.dataku.password = '';\n         this.dataku.confirmPassword = '';\n         this.dataku.users_id = null;\n         this.isPwd = true;\n         this.isPwd2 = true;\n         this.btn_password = false;\n         this.mdl_password = false;\n      },\n\n      resetHapusForm() {\n         this.form.id = null;\n         this.form.users_id = null;\n         this.btn_hapus = false;\n         this.mdl_hapus = false;\n      },\n\n\n\n      indexing(idx) {\n         return ((this.page_first - 1) * this.page_limit) + idx;\n      },\n\n      normalizeDate(dateStr) {\n         if (!dateStr || dateStr === '') return '';\n         if (/^\\d{4}-\\d{2}-\\d{2}$/.test(dateStr)) return dateStr;\n         if (dateStr.includes('T')) return dateStr.split('T')[0];\n         return '';\n      },\n\n      cari_data() { this.page_first = 1; this.getView(); },\n      openFoto() {\n         if (this.lihatData.foto_profil) {\n            const url = this.file_path + this.lihatData.foto_profil;\n            window.open(url, '_blank');\n         } else {\n            this.$q.notify({ type: 'negative', message: 'Foto tidak tersedia' });\n         }\n      },\n      openDokumen() {\n         if (this.lihatData.dokumen_pendukung) {\n            const url = this.file_path + this.lihatData.dokumen_pendukung;\n            window.open(url, '_blank');\n         } else {\n            this.$q.notify({ type: 'negative', message: 'Dokumen tidak tersedia' });\n         }\n      },\n      handleImageError(event) {\n         event.target.src = 'path/to/placeholder-image.jpg';  // Ganti dengan URL placeholder default, atau kosongkan src\n         // Atau: event.target.style.display = 'none'; untuk sembunyikan img rusak\n      },\n\n      async openRiwayat(pendonor) {\n  this.currentPendonor = pendonor || {};\n  this.riwayatList = [];\n  this.mdl_riwayat = true;\n  this.riwayatLoading = true;\n\n  const pendonorId = pendonor && (pendonor.id || pendonor.pendonor_id || pendonor.users_id || pendonor.user_id);\n  if (!pendonorId) {\n    this.$q.notify({ type: 'negative', message: 'ID pendonor tidak ditemukan' });\n    this.riwayatLoading = false;\n    return;\n  }\n\n  try {\n    // 1) Coba endpoint join yang efisien (sesuaikan nama endpoint kalau beda)\n    const urlJoin = this.$store.state.url.JADWAL_DONOR + \"getHistoryByPendonor\";\n    const res = await fetch(urlJoin, {\n      method: \"POST\",\n      headers: {\n        \"content-type\": \"application/json\",\n        authorization: \"kikensbatara \" + localStorage.token\n      },\n      body: JSON.stringify({ pendonor_id: pendonorId })\n    });\n    const json = await res.json();\n\n    if (json && Array.isArray(json.data) && json.data.length) {\n      this.riwayatList = json.data.map(it => ({\n        jadwal_id: it.jadwal_id || it.id || it.jadwal_id,\n        nama_kegiatan: it.nama_kegiatan || it.nama || it.judul,\n        tanggal_mulai: it.tanggal_mulai,\n        tanggal_selesai: it.tanggal_selesai,\n        lokasi: it.lokasi\n      }));\n      this.riwayatLoading = false;\n      return;\n    }\n\n    // 2) Fallback: ambil jadwal_peserta (list jadwal_id) lalu ambil jadwal_donor per id\n    const urlList = this.$store.state.url.REGIS_DONOR + \"getByPendonor\"; // sesuaikan nama endpoint\n    const res2 = await fetch(urlList, {\n      method: \"POST\",\n      headers: {\n        \"content-type\": \"application/json\",\n        authorization: \"kikensbatara \" + localStorage.token\n      },\n      body: JSON.stringify({ pendonor_id: pendonorId })\n    });\n    const json2 = await res2.json();\n    const list = json2.data || [];\n\n    if (!Array.isArray(list) || !list.length) {\n      this.riwayatList = [];\n      this.riwayatLoading = false;\n      return;\n    }\n\n    const jadwalIds = [...new Set(list.map(x => x.jadwal_id || x.jadwal || x.id_jadwal).filter(Boolean))];\n\n    // fetch details paralel (sesuaikan endpoint getById jika beda)\n    const fetches = jadwalIds.map(id =>\n      fetch(this.$store.state.url.JADWAL_DONOR + \"getById\", {\n        method: \"POST\",\n        headers: {\n          \"content-type\": \"application/json\",\n          authorization: \"kikensbatara \" + localStorage.token\n        },\n        body: JSON.stringify({ id })\n      })\n        .then(r => r.json())\n        .then(rj => rj.data || null)\n        .catch(err => {\n          console.error(\"Error fetching jadwal id\", id, err);\n          return null;\n        })\n    );\n\n    const jadwalDetails = await Promise.all(fetches);\n\n    this.riwayatList = jadwalDetails\n      .filter(Boolean)\n      .map(d => ({\n        jadwal_id: d.id,\n        nama_kegiatan: d.nama_kegiatan || d.judul || '-',\n        tanggal_mulai: d.tanggal_mulai,\n        tanggal_selesai: d.tanggal_selesai,\n        lokasi: d.lokasi\n      }));\n\n    this.riwayatLoading = false;\n  } catch (err) {\n    console.error(\"❌ Error openRiwayat:\", err);\n    this.$q.notify({ type: \"negative\", message: \"Gagal memuat riwayat donor\" });\n    this.riwayatLoading = false;\n  }\n}\n\n\n\n   },\n   mounted() {\n      this.getView();\n      this.loadKabupaten();\n   }\n}\n</script>\n"]}]}